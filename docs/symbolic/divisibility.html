
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>4. Numbers &#8212; Data Structures in Smalltalk  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Links" href="../linked-allocation/links.html" />
    <link rel="prev" title="3. Bits" href="bits.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Data Structures in Smalltalk</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=massimo-nocentini&repo=Booklet-DSst&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pharo/oo.html">1. Object model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pharo/hierarchies.html">2. Hierarchies</a></li>
<li class="toctree-l1"><a class="reference internal" href="bits.html">3. Bits</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">4. Numbers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fibonacci-numbers">4.1. Fibonacci numbers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#exponential-implementation">4.1.1. Exponential implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#memoized-implementation">4.1.2. Memoized implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tail-call-implementation">4.1.3. Tail-call implementation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#multiplication">4.2. Multiplication</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#horner-s-method">4.2.1. <em>Horner</em>'s method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#estrin-s-method">4.2.2. <em>Estrin</em>'s method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#karatsuba-s-method">4.2.3. <em>Karatsuba</em>'s method</a></li>
<li class="toctree-l3"><a class="reference internal" href="#factorials">4.2.4. Factorials</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#quotients-and-remainders">4.3. Quotients and remainders</a></li>
<li class="toctree-l2"><a class="reference internal" href="#greatest-common-divisor">4.4. Greatest Common Divisor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#diophantine-equations">4.5. Diophantine equations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#coprimes">4.5.1. Coprimes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mathbb-z-17-field">4.5.2. <span class="math notranslate nohighlight">\(\mathbb{Z}_{17}\)</span> field</a></li>
<li class="toctree-l3"><a class="reference internal" href="#gcd-f-n-f-n-1-where-f-n-is-the-n-th-fibonacci-number">4.5.3. <span class="math notranslate nohighlight">\(GCD(f_{n}, f_{n+1})\)</span>, where <span class="math notranslate nohighlight">\(f_{n}\)</span> is the <span class="math notranslate nohighlight">\(n\)</span>-th Fibonacci number</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kissing-fractions">4.5.4. Kissing <code class="docutils literal notranslate"><span class="pre">Fraction</span></code>s</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#skew-binary-canonical-sparse-representation">4.6. <em>Skew Binary Canonical</em> sparse representation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../linked-allocation/links.html">5. Links</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linked-allocation/linked-allocation.html">6. Containers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linked-allocation/storage-pools.html">7. Storage pools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bibliography.html">8. Bibliography</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="bits.html" title="previous chapter"><span class="section-number">3. </span>Bits</a></li>
      <li>Next: <a href="../linked-allocation/links.html" title="next chapter"><span class="section-number">5. </span>Links</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
              <div class="related top">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="bits.html" title="Previous document"><span class="section-number">3. </span>Bits</a>
        </li>
        <li>
          <a href="../linked-allocation/links.html" title="Next document"><span class="section-number">5. </span>Links</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          

          <div class="body" role="main">
            
  <section id="numbers">
<h1><span class="section-number">4. </span>Numbers<a class="headerlink" href="#numbers" title="Permalink to this headline">¶</a></h1>
<section id="fibonacci-numbers">
<h2><span class="section-number">4.1. </span>Fibonacci numbers<a class="headerlink" href="#fibonacci-numbers" title="Permalink to this headline">¶</a></h2>
<section id="exponential-implementation">
<span id="index-0"></span><h3><span class="section-number">4.1.1. </span>Exponential implementation<a class="headerlink" href="#exponential-implementation" title="Permalink to this headline">¶</a></h3>
<p>Let</p>
<span class="target" id="pharo-compiledMethod-0"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-slowfibonacci"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">slowFibonacci</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">&lt;</span> <span class="m">2</span>
        <span class="nb">ifTrue:</span> [ <span class="bp">self</span> ]
        <span class="nb">ifFalse:</span> [ 
        (<span class="bp">self</span> <span class="nf">-</span> <span class="m">1</span>) <span class="nf">slowFibonacci</span> <span class="nf">addNumber:</span> (<span class="bp">self</span> <span class="nf">-</span> <span class="m">2</span>) <span class="nf">slowFibonacci</span> ]
</pre></div>
</div>
<p>in</p>
<span class="target" id="pharo-compiledMethod-1"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-mwvisualizationstest-testprofileslowfibonacciwithadd"><div class="highlight"><pre><span></span><span class="c">&quot;MWVisualizationsTest, protocol tests&quot;</span>
<span class="nf">testProfileSlowFibonacciWithAdd</span>

   <span class="o">|</span><span class="nv"> wrapper handlerExecution tree metadata result wrapperAdd presenter </span><span class="o">|</span>
   <span class="nv">tree</span> <span class="o">:=</span> <span class="nc">CTOrderPreservingTree</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">handlerExecution</span> <span class="o">:=</span> <span class="nc">MWHandlerProfiling</span> <span class="nb">new</span>
                          <span class="nf">tree:</span> <span class="nv">tree</span><span class="p">;</span>
                          <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">wrapper</span> <span class="o">:=</span> <span class="nc">MWDecorator</span> <span class="nb">new</span>
                 <span class="nf">compiledMethod:</span> <span class="nc">Integer</span> <span class="nf">&gt;&gt;</span> <span class="ss">#slowFibonacci</span><span class="p">;</span>
                 <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                 <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">wrapperAdd</span> <span class="o">:=</span> <span class="nc">MWDecorator</span> <span class="nb">new</span>
                    <span class="nf">compiledMethod:</span> <span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#addNumber:</span><span class="p">;</span>
                    <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                    <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">result</span> <span class="o">:=</span> <span class="nc">MWSession</span> <span class="nb">new</span>
                <span class="nf">add:</span> <span class="nv">wrapper</span><span class="p">;</span>
                <span class="nf">add:</span> <span class="nv">wrapperAdd</span><span class="p">;</span>
                <span class="nf">value:</span> [ <span class="m">6</span> <span class="nf">slowFibonacci</span> ]<span class="p">.</span>

   <span class="nv">metadata</span> <span class="o">:=</span> <span class="nc">IdentityDictionary</span> <span class="nb">new</span><span class="p">.</span>
   <span class="nv">handlerExecution</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>

   <span class="c">&quot;Show here the new presenter.&quot;</span>
   <span class="nv">presenter</span> <span class="o">:=</span> (<span class="nc">MWSpPresenter</span> <span class="nf">on:</span> <span class="nv">tree</span> <span class="nf">-&gt;</span> <span class="nv">metadata</span>)
                   <span class="nf">useShapeSlotsDfsTree</span><span class="p">;</span>
                   <span class="nf">openWithSpec</span><span class="p">;</span>
                   <span class="nf">yourself</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">tree</span> <span class="nf">size</span> <span class="nf">equals:</span> <span class="m">37</span><span class="p">;</span>
      <span class="nf">assert:</span> <span class="nv">result</span> <span class="nf">equals:</span> <span class="m">7</span> <span class="nf">fibonacciNumbers</span> <span class="nf">last</span><span class="p">.</span> <span class="c">&quot; 55&quot;</span>

   <span class="bp">self</span>
      <span class="nf">export:</span> <span class="nv">tree</span>
      <span class="nf">pathSuffix:</span> <span class="s">&#39;sequence-diagram&#39;</span>
      <span class="nf">onCanvasDo:</span> [ <span class="o">:</span><span class="nv">aCanvas</span> <span class="o">:</span><span class="nv">useless</span> <span class="o">|</span> <span class="nv">presenter</span> <span class="nf">currentCanvas:</span> <span class="nv">aCanvas</span> ]
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/MWVisualizationsTest-testProfileSlowFibonacciWithAdd-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testProfileSlowFibonacciWithAdd-sequence-diagram.svg" /></div></blockquote>
<p id="index-1">Moreover, we can inspect the sequence of <em>additions</em> that are performed,</p>
<img alt="../_images/MWVisualizationsTest-testProfileSlowFibonacciWithAddOnly-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testProfileSlowFibonacciWithAddOnly-sequence-diagram.svg" /></section>
<section id="memoized-implementation">
<span id="index-2"></span><h3><span class="section-number">4.1.2. </span>Memoized implementation<a class="headerlink" href="#memoized-implementation" title="Permalink to this headline">¶</a></h3>
<p>To take the exponential complexity of the previous implementation we can use either memoization,</p>
<span class="target" id="pharo-compiledMethod-2"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-mwvisualizationstest-testprofileslowfibonaccimemoingwithadd"><div class="highlight"><pre><span></span><span class="c">&quot;MWVisualizationsTest, protocol tests&quot;</span>
<span class="nf">testProfileSlowFibonacciMemoingWithAdd</span>

   <span class="o">|</span><span class="nv"> tree result handlerExecution metadata presenter handlerCopying </span><span class="o">|</span>
   <span class="nv">tree</span> <span class="o">:=</span> <span class="nc">CTOrderPreservingTree</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">handlerExecution</span> <span class="o">:=</span> <span class="nc">MWHandlerProfiling</span> <span class="nb">new</span>
                          <span class="nf">tree:</span> <span class="nv">tree</span><span class="p">;</span>
                          <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">handlerCopying</span> <span class="o">:=</span> <span class="nc">MWHandlerReceiverArgumentsCopying</span> <span class="nb">new</span>
                        <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                        <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">result</span> <span class="o">:=</span> <span class="nc">MWSession</span> <span class="nb">new</span>
                <span class="nf">add:</span> (<span class="nc">MWDecorator</span> <span class="nb">new</span>
                       <span class="nf">compiledMethod:</span> <span class="nc">Integer</span> <span class="nf">&gt;&gt;</span> <span class="ss">#slowFibonacciMemo:</span><span class="p">;</span>
                       <span class="nf">handler:</span> <span class="nv">handlerCopying</span><span class="p">;</span>
                       <span class="nf">yourself</span>)<span class="p">;</span>
                <span class="nf">add:</span> (<span class="nc">MWDecorator</span> <span class="nb">new</span>
                       <span class="nf">compiledMethod:</span> <span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#addNumber:</span><span class="p">;</span>
                       <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                       <span class="nf">yourself</span>)<span class="p">;</span>
                <span class="nf">value:</span> [ <span class="m">6</span> <span class="nf">slowFibonacciMemo:</span> <span class="nc">Dictionary</span> <span class="nb">new</span> ]<span class="p">.</span>

   <span class="nv">metadata</span> <span class="o">:=</span> <span class="nc">IdentityDictionary</span> <span class="nb">new</span><span class="p">.</span>
   <span class="nv">handlerExecution</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>
   <span class="nv">handlerCopying</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>

   <span class="c">&quot;Show here the new presenter.&quot;</span>
   <span class="nv">presenter</span> <span class="o">:=</span> (<span class="nc">MWSpPresenter</span> <span class="nf">on:</span> <span class="nv">tree</span> <span class="nf">-&gt;</span> <span class="nv">metadata</span>)
                   <span class="nf">useShapeSlotsDfsTree</span><span class="p">;</span>
                   <span class="nf">openWithSpec</span><span class="p">;</span>
                   <span class="nf">yourself</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">tree</span> <span class="nf">size</span> <span class="nf">equals:</span> <span class="m">16</span><span class="p">;</span>
      <span class="nf">assert:</span> <span class="nv">result</span> <span class="nf">equals:</span> <span class="m">7</span> <span class="nf">fibonacciNumbers</span> <span class="nf">last</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">export:</span> <span class="nv">tree</span>
      <span class="nf">pathSuffix:</span> <span class="s">&#39;sequence-diagram&#39;</span>
      <span class="nf">onCanvasDo:</span> [ <span class="o">:</span><span class="nv">aCanvas</span> <span class="o">:</span><span class="nv">useless</span> <span class="o">|</span> <span class="nv">presenter</span> <span class="nf">currentCanvas:</span> <span class="nv">aCanvas</span> ]
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/MWVisualizationsTest-testProfileSlowFibonacciMemoingWithAdd-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testProfileSlowFibonacciMemoingWithAdd-sequence-diagram.svg" /></div></blockquote>
<p>where</p>
<span class="target" id="pharo-compiledMethod-3"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-slowfibonaccimemo"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">slowFibonacciMemo:</span> <span class="nv">aDictionary</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">&lt;</span> <span class="m">2</span>
        <span class="nb">ifTrue:</span> [ <span class="bp">self</span> ]
        <span class="nb">ifFalse:</span> [ 
           <span class="nv">aDictionary</span> <span class="nf">at:</span> <span class="bp">self</span> <span class="nf">ifAbsentPut:</span> [ 
              (<span class="bp">self</span> <span class="nf">-</span> <span class="m">1</span> <span class="nf">slowFibonacciMemo:</span> <span class="nv">aDictionary</span>) <span class="nf">addNumber:</span>
                 (<span class="bp">self</span> <span class="nf">-</span> <span class="m">2</span> <span class="nf">slowFibonacciMemo:</span> <span class="nv">aDictionary</span>) ] ]
</pre></div>
</div>
</section>
<section id="tail-call-implementation">
<span id="index-3"></span><h3><span class="section-number">4.1.3. </span>Tail-call implementation<a class="headerlink" href="#tail-call-implementation" title="Permalink to this headline">¶</a></h3>
<p>Or tail-call messages,</p>
<span class="target" id="pharo-compiledMethod-4"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-mwvisualizationstest-testprofileslowfibonaccitailwithadd"><div class="highlight"><pre><span></span><span class="c">&quot;MWVisualizationsTest, protocol tests&quot;</span>
<span class="nf">testProfileSlowFibonacciTailWithAdd</span>

   <span class="o">|</span><span class="nv"> wrapper handlerExecution tree metadata result wrapperAdd presenter </span><span class="o">|</span>
   <span class="nv">tree</span> <span class="o">:=</span> <span class="nc">CTOrderPreservingTree</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">handlerExecution</span> <span class="o">:=</span> <span class="nc">MWHandlerProfiling</span> <span class="nb">new</span>
                          <span class="nf">tree:</span> <span class="nv">tree</span><span class="p">;</span>
                          <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">wrapper</span> <span class="o">:=</span> <span class="nc">MWDecorator</span> <span class="nb">new</span>
                 <span class="nf">compiledMethod:</span> <span class="nc">Integer</span> <span class="nf">&gt;&gt;</span> <span class="ss">#slowFibonacci:tail:</span><span class="p">;</span>
                 <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                 <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">wrapperAdd</span> <span class="o">:=</span> <span class="nc">MWDecorator</span> <span class="nb">new</span>
                    <span class="nf">compiledMethod:</span> <span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#addNumber:</span><span class="p">;</span>
                    <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                    <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">result</span> <span class="o">:=</span> <span class="nc">MWSession</span> <span class="nb">new</span>
                <span class="nf">add:</span> <span class="nv">wrapper</span><span class="p">;</span>
                <span class="nf">add:</span> <span class="nv">wrapperAdd</span><span class="p">;</span>
                <span class="nf">value:</span> [ <span class="m">6</span> <span class="nf">slowFibonacci:</span> <span class="m">0</span> <span class="nf">tail:</span> <span class="m">1</span> ]<span class="p">.</span>

   <span class="nv">metadata</span> <span class="o">:=</span> <span class="nc">IdentityDictionary</span> <span class="nb">new</span><span class="p">.</span>
   <span class="nv">handlerExecution</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>

   <span class="c">&quot;Show here the new presenter.&quot;</span>
   <span class="nv">presenter</span> <span class="o">:=</span> (<span class="nc">MWSpPresenter</span> <span class="nf">on:</span> <span class="nv">tree</span> <span class="nf">-&gt;</span> <span class="nv">metadata</span>)
                   <span class="nf">useShapeSlotsDfsTree</span><span class="p">;</span>
                   <span class="nf">openWithSpec</span><span class="p">;</span>
                   <span class="nf">yourself</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">tree</span> <span class="nf">size</span> <span class="nf">equals:</span> <span class="m">13</span><span class="p">;</span>
      <span class="nf">assert:</span> <span class="nv">result</span> <span class="nf">equals:</span> <span class="m">7</span> <span class="nf">fibonacciNumbers</span> <span class="nf">last</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">export:</span> <span class="nv">tree</span>
      <span class="nf">pathSuffix:</span> <span class="s">&#39;sequence-diagram&#39;</span>
      <span class="nf">onCanvasDo:</span> [ <span class="o">:</span><span class="nv">aCanvas</span> <span class="o">:</span><span class="nv">useless</span> <span class="o">|</span> <span class="nv">presenter</span> <span class="nf">currentCanvas:</span> <span class="nv">aCanvas</span> ]
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/MWVisualizationsTest-testProfileSlowFibonacciTailWithAdd-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testProfileSlowFibonacciTailWithAdd-sequence-diagram.svg" /></div></blockquote>
<p>where</p>
<span class="target" id="pharo-compiledMethod-5"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-slowfibonacci-tail"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">slowFibonacci:</span> <span class="nv">a</span> <span class="nf">tail:</span> <span class="nv">b</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">&gt;</span> <span class="m">0</span>
        <span class="nb">ifTrue:</span> [ <span class="bp">self</span> <span class="nf">-</span> <span class="m">1</span> <span class="nf">slowFibonacci:</span> <span class="nv">b</span> <span class="nf">tail:</span> (<span class="nv">a</span> <span class="nf">addNumber:</span> <span class="nv">b</span>) ]
        <span class="nb">ifFalse:</span> [ <span class="nv">a</span> ]
</pre></div>
</div>
</section>
</section>
<section id="multiplication">
<h2><span class="section-number">4.2. </span>Multiplication<a class="headerlink" href="#multiplication" title="Permalink to this headline">¶</a></h2>
<section id="horner-s-method">
<h3><span class="section-number">4.2.1. </span><em>Horner</em>'s method<a class="headerlink" href="#horner-s-method" title="Permalink to this headline">¶</a></h3>
<p>Let</p>
<span class="target" id="pharo-compiledMethod-6"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-sequenceablecollection-horner-init"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-Essentials&quot;</span>
<span class="nf">horner:</span> <span class="nv">base</span> <span class="nf">init:</span> <span class="nv">init</span>

   <span class="o">^</span> <span class="bp">self</span>
        <span class="nf">inject:</span> <span class="nv">init</span>
        <span class="nf">into:</span> [ <span class="o">:</span><span class="nv">acc</span> <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> (<span class="nv">acc</span> <span class="nf">multiplyNumber:</span> <span class="nv">base</span>) <span class="nf">addNumber:</span> <span class="nv">each</span> ]
</pre></div>
</div>
<p>in</p>
<span class="target" id="pharo-compiledMethod-7"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-mwvisualizationstest-testsequenceablecollectionhornerinit"><div class="highlight"><pre><span></span><span class="c">&quot;MWVisualizationsTest, protocol tests&quot;</span>
<span class="nf">testSequenceableCollectionHornerInit</span>

   <span class="o">|</span><span class="nv"> tree metadata result handlerExecution handlerCopying presenter </span><span class="o">|</span>
   <span class="nv">tree</span> <span class="o">:=</span> <span class="nc">CTOrderPreservingTree</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">handlerExecution</span> <span class="o">:=</span> <span class="nc">MWHandlerProfiling</span> <span class="nb">new</span>
                          <span class="nf">tree:</span> <span class="nv">tree</span><span class="p">;</span>
                          <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">handlerCopying</span> <span class="o">:=</span> <span class="nc">MWHandlerReceiverArgumentsCopying</span> <span class="nb">new</span>
                        <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                        <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">result</span> <span class="o">:=</span> (<span class="nc">MWSession</span> <span class="nf">withAllImplementations:</span> { 
                       (<span class="nc">SequenceableCollection</span> <span class="nf">&gt;&gt;</span> <span class="ss">#horner:init:</span>)<span class="p">.</span>
                       <span class="c">&quot;(Collection &gt;&gt; #inject:into:).&quot;</span>
                       (<span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#addNumber:</span>)<span class="p">.</span>
                       (<span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#multiplyNumber:</span>) })
                <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">each</span> <span class="nf">handler:</span> <span class="nv">handlerCopying</span> ]<span class="p">;</span>
                <span class="nf">value:</span> [ { <span class="m">1</span><span class="p">.</span> <span class="m">3</span><span class="p">.</span> <span class="m">5</span><span class="p">.</span> <span class="m">6</span> } <span class="nf">hornerBase10</span> ]<span class="p">.</span>

   <span class="nv">metadata</span> <span class="o">:=</span> <span class="nc">IdentityDictionary</span> <span class="nb">new</span><span class="p">.</span>
   <span class="nv">handlerExecution</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>
   <span class="nv">handlerCopying</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>

   <span class="c">&quot;Show here the new presenter.&quot;</span>
   <span class="nv">presenter</span> <span class="o">:=</span> (<span class="nc">MWSpPresenter</span> <span class="nf">on:</span> <span class="nv">tree</span> <span class="nf">-&gt;</span> <span class="nv">metadata</span>)
                   <span class="nf">useShapeSlotsDfsTree</span><span class="p">;</span>
                   <span class="nf">openWithSpec</span><span class="p">;</span>
                   <span class="nf">yourself</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">tree</span> <span class="nf">size</span> <span class="nf">equals:</span> <span class="m">9</span><span class="p">;</span>
      <span class="nf">assert:</span> <span class="nv">result</span> <span class="nf">equals:</span> <span class="m">1356</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">export:</span> <span class="nv">tree</span>
      <span class="nf">pathSuffix:</span> <span class="s">&#39;sequence-diagram&#39;</span>
      <span class="nf">onCanvasDo:</span> [ <span class="o">:</span><span class="nv">aCanvas</span> <span class="o">:</span><span class="nv">useless</span> <span class="o">|</span> <span class="nv">presenter</span> <span class="nf">currentCanvas:</span> <span class="nv">aCanvas</span> ]<span class="p">;</span>
      <span class="nf">exportSlotsGraphOf:</span> <span class="nv">result</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/MWVisualizationsTest-testSequenceableCollectionHornerInit.svg" class="align-center" src="../_images/MWVisualizationsTest-testSequenceableCollectionHornerInit.svg" /></div></blockquote>
<p id="index-4">that admits the profiling,</p>
<img alt="../_images/MWVisualizationsTest-testSequenceableCollectionHornerInit-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testSequenceableCollectionHornerInit-sequence-diagram.svg" /></section>
<section id="estrin-s-method">
<span id="index-5"></span><h3><span class="section-number">4.2.2. </span><em>Estrin</em>'s method<a class="headerlink" href="#estrin-s-method" title="Permalink to this headline">¶</a></h3>
<p>According to <span id="id1">[<a class="reference internal" href="../bibliography.html#id20" title="Gerald Estrin. Organization of computer systems: the fixed plus variable structure computer. In Papers Presented at the May 3-5, 1960, Western Joint IRE-AIEE-ACM Computer Conference, 33–40. New York, NY, USA, 1960. Association for Computing Machinery. doi:10.1145/1460361.1460365.">Est60</a>]</span>, let</p>
<span class="target" id="pharo-compiledMethod-8"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-sequenceablecollection-estrin-init"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-Essentials&quot;</span>
<span class="nf">estrin:</span> <span class="nv">base</span> <span class="nf">init:</span> <span class="nv">init</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">ifEmpty:</span> [ <span class="nv">init</span> ] <span class="nf">ifNotEmpty:</span> [ 
        <span class="bp">self</span> <span class="nf">size</span> <span class="nf">=</span> <span class="m">1</span>
           <span class="nb">ifTrue:</span> [ <span class="bp">self</span> <span class="nf">first</span> ]
           <span class="nb">ifFalse:</span> [ 
              <span class="o">|</span> <span class="nv">odd</span> <span class="nf">even</span> <span class="nf">squared</span> <span class="nf">|</span>
              <span class="nv">even</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">class</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">evenStream</span> <span class="o">|</span> 
                         <span class="nv">odd</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">class</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">oddStream</span> <span class="o">|</span> 
                                   <span class="bp">self</span> <span class="nf">withIndexDo:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">:</span><span class="nv">i</span> <span class="o">|</span> 
                                      <span class="nv">i</span> <span class="nf">even</span>
                                         <span class="nb">ifTrue:</span> [ <span class="nv">evenStream</span> <span class="nf">nextPut:</span> <span class="nv">each</span> ]
                                         <span class="nb">ifFalse:</span> [ <span class="nv">oddStream</span> <span class="nf">nextPut:</span> <span class="nv">each</span> ] ] ] ]<span class="p">.</span>

              <span class="nv">squared</span> <span class="o">:=</span> <span class="nv">base</span> <span class="nf">squared</span><span class="p">.</span>

              (<span class="nv">even</span> <span class="nf">estrin:</span> <span class="nv">squared</span> <span class="nf">init:</span> <span class="nv">init</span>) <span class="nf">addNumber:</span>
                 ((<span class="nv">odd</span> <span class="nf">estrin:</span> <span class="nv">squared</span> <span class="nf">init:</span> <span class="nv">init</span>) <span class="nf">multiplyNumber:</span> <span class="nv">base</span>) ] ]
</pre></div>
</div>
<p>in</p>
<span class="target" id="pharo-compiledMethod-9"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-mwvisualizationstest-testsequenceablecollectionestrininit"><div class="highlight"><pre><span></span><span class="c">&quot;MWVisualizationsTest, protocol tests&quot;</span>
<span class="nf">testSequenceableCollectionEstrinInit</span>

   <span class="o">|</span><span class="nv"> tree metadata result handlerExecution handlerCopying presenter </span><span class="o">|</span>
   <span class="nv">tree</span> <span class="o">:=</span> <span class="nc">CTOrderPreservingTree</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">handlerExecution</span> <span class="o">:=</span> <span class="nc">MWHandlerProfiling</span> <span class="nb">new</span>
                          <span class="nf">tree:</span> <span class="nv">tree</span><span class="p">;</span>
                          <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">handlerCopying</span> <span class="o">:=</span> <span class="nc">MWHandlerReceiverArgumentsCopying</span> <span class="nb">new</span>
                        <span class="nf">handler:</span> <span class="nv">handlerExecution</span><span class="p">;</span>
                        <span class="nf">yourself</span><span class="p">.</span>

   <span class="nv">result</span> <span class="o">:=</span> (<span class="nc">MWSession</span> <span class="nf">withAllImplementations:</span> { 
                       (<span class="nc">SequenceableCollection</span> <span class="nf">&gt;&gt;</span> <span class="ss">#estrin:init:</span>)<span class="p">.</span>
                       <span class="c">&quot;(Collection &gt;&gt; #inject:into:).&quot;</span>
                       (<span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#addNumber:</span>)<span class="p">.</span>
                       (<span class="nc">Number</span> <span class="nf">&gt;&gt;</span> <span class="ss">#multiplyNumber:</span>) })
                <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">each</span> <span class="nf">handler:</span> <span class="nv">handlerCopying</span> ]<span class="p">;</span>
                <span class="nf">value:</span> [ { <span class="m">1</span><span class="p">.</span> <span class="m">3</span><span class="p">.</span> <span class="m">5</span><span class="p">.</span> <span class="m">6</span><span class="p">.</span> <span class="m">9</span> } <span class="nf">estrin:</span> <span class="m">10</span> ]<span class="p">.</span>

   <span class="nv">metadata</span> <span class="o">:=</span> <span class="nc">IdentityDictionary</span> <span class="nb">new</span><span class="p">.</span>
   <span class="nv">handlerExecution</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>
   <span class="nv">handlerCopying</span> <span class="nf">metadata:</span> <span class="nv">metadata</span><span class="p">.</span>

   <span class="c">&quot;Show here the new presenter.&quot;</span>
   <span class="nv">presenter</span> <span class="o">:=</span> (<span class="nc">MWSpPresenter</span> <span class="nf">on:</span> <span class="nv">tree</span> <span class="nf">-&gt;</span> <span class="nv">metadata</span>)
                   <span class="nf">useShapeSlotsDfsTree</span><span class="p">;</span>
                   <span class="nf">openWithSpec</span><span class="p">;</span>
                   <span class="nf">yourself</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">tree</span> <span class="nf">size</span> <span class="nf">equals:</span> <span class="m">17</span><span class="p">;</span>
      <span class="nf">assert:</span> <span class="nv">result</span> <span class="nf">equals:</span> <span class="m">13569</span><span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">export:</span> <span class="nv">tree</span>
      <span class="nf">pathSuffix:</span> <span class="s">&#39;sequence-diagram&#39;</span>
      <span class="nf">onCanvasDo:</span> [ <span class="o">:</span><span class="nv">aCanvas</span> <span class="o">:</span><span class="nv">useless</span> <span class="o">|</span> <span class="nv">presenter</span> <span class="nf">currentCanvas:</span> <span class="nv">aCanvas</span> ]<span class="p">;</span>
      <span class="nf">exportSlotsGraphOf:</span> <span class="nv">result</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/MWVisualizationsTest-testSequenceableCollectionEstrinInit.svg" class="align-center" src="../_images/MWVisualizationsTest-testSequenceableCollectionEstrinInit.svg" /></div></blockquote>
<p id="index-6">where</p>
<span class="target" id="pharo-compiledMethod-10"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-sequenceablecollection-estrin"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-Essentials&quot;</span>
<span class="nf">estrin:</span> <span class="nv">x</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">reversed</span> <span class="nf">estrin:</span> <span class="nv">x</span> <span class="nf">init:</span> <span class="m">0</span>
</pre></div>
</div>
<p>admits the profiling,</p>
<img alt="../_images/MWVisualizationsTest-testSequenceableCollectionEstrinInit-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testSequenceableCollectionEstrinInit-sequence-diagram.svg" /></section>
<section id="karatsuba-s-method">
<span id="index-7"></span><h3><span class="section-number">4.2.3. </span><em>Karatsuba</em>'s method<a class="headerlink" href="#karatsuba-s-method" title="Permalink to this headline">¶</a></h3>
<p>Here we explore a large integer</p>
<img alt="../_images/EssentialsObjectTest-testInspectLargeInteger.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectLargeInteger.svg" /><p>that equals <span class="math notranslate nohighlight">\((42!)^{2}\)</span> where squaring is performed by multiplication of
<span class="math notranslate nohighlight">\(42!\)</span> with itself by means of the message</p>
<span class="target" id="pharo-compiledMethod-11"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-karatsuba-base"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">karatsuba:</span> <span class="nv">anInteger</span> <span class="nf">base:</span> <span class="nv">base</span>

   <span class="o">^</span> ((<span class="bp">self</span> <span class="nf">between:</span> <span class="m">0</span> <span class="nf">and:</span> <span class="nv">base</span> <span class="nf">-</span> <span class="m">1</span>) <span class="nf">and:</span> [ 
         <span class="nv">anInteger</span> <span class="nf">between:</span> <span class="m">0</span> <span class="nf">and:</span> <span class="nv">base</span> <span class="nf">-</span> <span class="m">1</span> ])
        <span class="nb">ifTrue:</span> [ <span class="bp">self</span> <span class="nf">multiplyNumber:</span> <span class="nv">anInteger</span> ]
        <span class="nb">ifFalse:</span> [ 
           <span class="o">|</span> <span class="nv">x</span> <span class="nf">y</span> <span class="nf">yDigits</span> <span class="nf">|</span>
           (<span class="bp">self</span> <span class="nf">numberOfDigitsInBase:</span> <span class="nv">base</span>)
           <span class="nf">&gt;</span> (<span class="nv">anInteger</span> <span class="nf">numberOfDigitsInBase:</span> <span class="nv">base</span>)
              <span class="nb">ifTrue:</span> [ 
                 <span class="nv">x</span> <span class="o">:=</span> <span class="bp">self</span><span class="p">.</span>
                 <span class="nv">y</span> <span class="o">:=</span> <span class="nv">anInteger</span> ]
              <span class="nb">ifFalse:</span> [ 
                 <span class="nv">x</span> <span class="o">:=</span> <span class="nv">anInteger</span><span class="p">.</span>
                 <span class="nv">y</span> <span class="o">:=</span> <span class="bp">self</span> ]<span class="p">.</span>

           <span class="nv">yDigits</span> <span class="o">:=</span> <span class="nv">y</span> <span class="nf">numberOfDigitsInBase:</span> <span class="nv">base</span><span class="p">.</span>

           <span class="nv">x</span>
              <span class="nf">halves:</span> [ <span class="o">:</span><span class="nv">xHigh</span> <span class="o">:</span><span class="nv">xLow</span> <span class="o">:</span><span class="nv">xn</span> <span class="o">:</span><span class="nv">xl</span> <span class="o">|</span> 
                 <span class="nv">y</span>
                    <span class="nf">halves:</span> [ <span class="o">:</span><span class="nv">yHigh</span> <span class="o">:</span><span class="nv">yLow</span> <span class="o">:</span><span class="nv">yn</span> <span class="o">:</span><span class="nv">yl</span> <span class="o">|</span> 
                       <span class="o">|</span><span class="nv"> p pp xyHigh xyLow exp </span><span class="o">|</span>
                       <span class="nv">p</span> <span class="o">:=</span> (<span class="nv">xHigh</span> <span class="nf">addNumber:</span> <span class="nv">xLow</span>)
                               <span class="nf">karatsuba:</span> (<span class="nv">yHigh</span> <span class="nf">addNumber:</span> <span class="nv">yLow</span>)
                               <span class="nf">base:</span> <span class="nv">base</span><span class="p">.</span>
                       <span class="nv">xyHigh</span> <span class="o">:=</span> <span class="nv">xHigh</span> <span class="nf">karatsuba:</span> <span class="nv">yHigh</span> <span class="nf">base:</span> <span class="nv">base</span><span class="p">.</span>
                       <span class="nv">xyLow</span> <span class="o">:=</span> <span class="nv">xLow</span> <span class="nf">karatsuba:</span> <span class="nv">yLow</span> <span class="nf">base:</span> <span class="nv">base</span><span class="p">.</span>

                       <span class="nv">exp</span> <span class="o">:=</span> <span class="nv">base</span> <span class="nf">**</span> <span class="nv">xl</span><span class="p">.</span>
                       <span class="nv">pp</span> <span class="o">:=</span> <span class="nv">p</span> <span class="nf">subtractNumber:</span> (<span class="nv">xyHigh</span> <span class="nf">addNumber:</span> <span class="nv">xyLow</span>)<span class="p">.</span>

                       <span class="c">&quot;According to the Horner schema.&quot;</span>
                       (((<span class="nv">xyHigh</span> <span class="nf">multiplyNumber:</span> <span class="nv">exp</span>) <span class="nf">addNumber:</span> <span class="nv">pp</span>) 
                           <span class="nf">multiplyNumber:</span> <span class="nv">exp</span>) <span class="nf">addNumber:</span> <span class="nv">xyLow</span> ]
                    <span class="nf">at:</span> <span class="nv">xl</span>
                    <span class="nf">digits:</span> <span class="nv">yDigits</span>
                    <span class="nf">base:</span> <span class="nv">base</span> ]
              <span class="nf">base:</span> <span class="nv">base</span> ]
</pre></div>
</div>
<p>according to the algorithm described in <span id="id2">[<a class="reference internal" href="../bibliography.html#id14" title="Jon Kleinberg and Eva Tardos. Algorithm Design. Addison-Wesley Longman Publishing Co., Inc., USA, 2005. ISBN 0321295358.">KT05</a>]</span>, page 232.
Such algorithm runs in <span class="math notranslate nohighlight">\(O(n^{\log_{2}{3}})\)</span> because the input numbers
<span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>,</p>
<div class="math notranslate nohighlight">
\[\begin{split}x = x_{a}\cdot 10^{a} + x_{a-1}\cdot 10^{a-1} + \cdots + x_{1}\cdot 10^{1} + x_{0}\cdot 10^{0} \\
y = y_{b}\cdot 10^{b} + y_{b-1}\cdot 10^{b-1} + \cdots + y_{1}\cdot 10^{1} + y_{0}\cdot 10^{0}\end{split}\]</div>
<p>and let <span class="math notranslate nohighlight">\(n = \max(a, b)\)</span>, are broken in <em>two</em> parts</p>
<div class="math notranslate nohighlight">
\[\begin{split}x = x_{1}\cdot 10^{{{n}\over{2}}} + x_{0} \\
y = y_{1}\cdot 10^{{{n}\over{2}}} + y_{0}\end{split}\]</div>
<p>respectively, and there are <em>three</em> recursive <code class="docutils literal notranslate"><span class="pre">#karatsuba:base:</span></code> message sends.
The implementation follows from both the fact</p>
<div class="math notranslate nohighlight">
\[x\,y = x_{1}\,y_{1}\cdot 10^{n} + (x_{1}\,y_{0} + x_{0}\,y_{1})\cdot 10^{{{n}\over{2}}} + x_{0}\,y_{0}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[(x_{1} + x_{0})\,(y_{1} + y_{0}) = x_{1}\,y_{1} + \left(x_{1}\,y_{0} + x_{0}\,y_{1}\right) + x_{0}\,y_{0}\]</div>
<p>respectively, more references can also be found in
<span id="id3">[<a class="reference internal" href="../bibliography.html#id15" title="Wikipedia. Karatsuba algorithm. URL: https://en.wikipedia.org/wiki/Karatsuba_algorithm.">Wik</a>]</span>. Two auxiliary messages</p>
<span class="target" id="pharo-compiledMethod-12"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-halves-base"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">halves:</span> <span class="nv">aBlock</span> <span class="nf">base:</span> <span class="nv">aBase</span>

   <span class="o">|</span><span class="nv"> n </span><span class="o">|</span>
   <span class="nv">n</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">numberOfDigitsInBase:</span> <span class="nv">aBase</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span>
        <span class="nf">halves:</span> <span class="nv">aBlock</span>
        <span class="nf">at:</span> (<span class="nv">n</span> <span class="nf">/</span> <span class="m">2</span>) <span class="nf">ceiling</span>
        <span class="nf">digits:</span> <span class="nv">n</span>
        <span class="nf">base:</span> <span class="nv">aBase</span>
</pre></div>
</div>
<p>and</p>
<span class="target" id="pharo-compiledMethod-13"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-halves-at-digits-base"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">halves:</span> <span class="nv">aBlock</span> <span class="nf">at:</span> <span class="nv">l</span> <span class="nf">digits:</span> <span class="nv">n</span> <span class="nf">base:</span> <span class="nv">aBase</span>

   <span class="o">|</span><span class="nv"> low high lSucc </span><span class="o">|</span>
   <span class="nv">lSucc</span> <span class="o">:=</span> <span class="nv">l</span> <span class="nf">+</span> <span class="m">1</span><span class="p">.</span>

   <span class="nv">low</span> <span class="o">:=</span> (<span class="m">1</span> <span class="nf">to:</span> <span class="nv">l</span>) <span class="nf">inject:</span> <span class="m">0</span> <span class="nf">into:</span> [ <span class="o">:</span><span class="nv">acc</span> <span class="o">:</span><span class="nv">i</span> <span class="o">|</span> 
             <span class="o">|</span><span class="nv"> d </span><span class="o">|</span>
             <span class="nv">d</span> <span class="o">:=</span> (<span class="bp">self</span> <span class="nf">digitAt:</span> <span class="nv">i</span> <span class="nf">base:</span> <span class="nv">aBase</span>) <span class="nf">*</span> (<span class="nv">aBase</span> <span class="nf">**</span> (<span class="nv">i</span> <span class="nf">-</span> <span class="m">1</span>))<span class="p">.</span>
             <span class="nv">d</span> <span class="nf">+</span> <span class="nv">acc</span> ]<span class="p">.</span>

   <span class="nv">high</span> <span class="o">:=</span> (<span class="nv">lSucc</span> <span class="nf">to:</span> <span class="nv">n</span>) <span class="nf">inject:</span> <span class="m">0</span> <span class="nf">into:</span> [ <span class="o">:</span><span class="nv">acc</span> <span class="o">:</span><span class="nv">i</span> <span class="o">|</span> 
              <span class="o">|</span><span class="nv"> d </span><span class="o">|</span>
              <span class="nv">d</span> <span class="o">:=</span> (<span class="bp">self</span> <span class="nf">digitAt:</span> <span class="nv">i</span> <span class="nf">base:</span> <span class="nv">aBase</span>) <span class="nf">*</span> (<span class="nv">aBase</span> <span class="nf">**</span> (<span class="nv">i</span> <span class="nf">-</span> <span class="nv">lSucc</span>))<span class="p">.</span>
              <span class="nv">d</span> <span class="nf">+</span> <span class="nv">acc</span> ]<span class="p">.</span>

   <span class="o">^</span> <span class="nv">aBlock</span>
        <span class="nf">value:</span> <span class="nv">high</span>
        <span class="nf">value:</span> <span class="nv">low</span>
        <span class="nf">value:</span> <span class="nv">n</span>
        <span class="nf">value:</span> <span class="nv">l</span>
</pre></div>
</div>
<p>helps the recursive message.</p>
<p id="index-8">A complete profiling of <span class="math notranslate nohighlight">\(835 \cdot 714\)</span> using this technique looks like</p>
<img alt="../_images/MWVisualizationsTest-testInspectLargeIntegerProfiled-sequence-diagram.svg" class="align-center" src="../_images/MWVisualizationsTest-testInspectLargeIntegerProfiled-sequence-diagram.svg" /></section>
<section id="factorials">
<h3><span class="section-number">4.2.4. </span>Factorials<a class="headerlink" href="#factorials" title="Permalink to this headline">¶</a></h3>
<p>According the post <span id="id4">[<a class="reference internal" href="../bibliography.html#id13" title="Sven VC. Speeding up factorial computation by changing the order of multiplications. URL: https://medium.com/concerning-pharo/speeding-up-factorial-computation-by-changing-the-order-of-multiplications-f4da3a5576da.">VC</a>]</span>, we implement the factorial
function twice in order to compute</p>
<div class="math notranslate nohighlight">
\[16! = 20922789888000\]</div>
<p>On one hand, the slow version follows straightforward from the mathematical definition,</p>
<span class="target" id="pharo-compiledMethod-14"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-factorialrecursive"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">factorialRecursive</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">&gt;</span> <span class="m">0</span>
        <span class="nb">ifTrue:</span> [ 
        <span class="bp">self</span> <span class="nf">multiplyNumber:</span> (<span class="bp">self</span> <span class="nf">subtractNumber:</span> <span class="m">1</span>) <span class="nf">factorialRecursive</span> ]
        <span class="nb">ifFalse:</span> [ 
           <span class="bp">self</span> <span class="nf">=</span> <span class="m">0</span>
              <span class="nb">ifTrue:</span> [ <span class="m">1</span> ]
              <span class="nb">ifFalse:</span> [ <span class="bp">self</span> <span class="nf">error:</span> <span class="s">&#39;Not valid for negative integers&#39;</span> ] ]
</pre></div>
</div>
<p>and the interactions are</p>
<img alt="../_images/MWVisualizationsTest-testInspectFactorialRecursive-sequence-diagram.svg" class="align-center" id="index-9" src="../_images/MWVisualizationsTest-testInspectFactorialRecursive-sequence-diagram.svg" /><p>On the other hand, the fast version uses a divide and conquer approach,</p>
<span class="target" id="pharo-compiledMethod-15"><span id="index-10"></span></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-productto"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">productTo:</span> <span class="nv">upper</span>

   <span class="c">&quot;Return the product of all integers between </span>
<span class="c">   the receiver (exclusive) and upper (inclusive).&quot;</span>

   <span class="o">|</span><span class="nv"> delta product middle </span><span class="o">|</span>
   <span class="nv">delta</span> <span class="o">:=</span> <span class="nv">upper</span> <span class="nf">subtractNumber:</span> <span class="bp">self</span><span class="p">.</span>
   <span class="o">^</span> <span class="nv">delta</span> <span class="nf">&lt;=</span> <span class="m">0</span>
        <span class="nb">ifTrue:</span> [ <span class="nc">Error</span> <span class="nf">signal</span> ]
        <span class="nb">ifFalse:</span> [ 
           <span class="nv">delta</span> <span class="nf">&lt;</span> <span class="m">5</span>
              <span class="nb">ifTrue:</span> [ 
                 <span class="nv">product</span> <span class="o">:=</span> <span class="nv">upper</span><span class="p">.</span>
                 <span class="m">1</span> <span class="nf">to:</span> <span class="nv">delta</span> <span class="nf">-</span> <span class="m">1</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> 
                    <span class="nv">product</span> <span class="o">:=</span> (<span class="nv">upper</span> <span class="nf">subtractNumber:</span> <span class="nv">each</span>) <span class="nf">multiplyNumber:</span>
                                  <span class="nv">product</span> ]<span class="p">.</span>
                 <span class="nv">product</span> ]
              <span class="nb">ifFalse:</span> [ 
                 <span class="nv">middle</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">+</span> <span class="nv">upper</span> <span class="nf">&gt;&gt;</span> <span class="m">1</span><span class="p">.</span>
                 (<span class="bp">self</span> <span class="nf">productTo:</span> <span class="nv">middle</span>) <span class="nf">multiplyNumber:</span>
                    (<span class="nv">middle</span> <span class="nf">productTo:</span> <span class="nv">upper</span>) ] ]
</pre></div>
</div>
<p>and the interactions are</p>
<img alt="../_images/MWVisualizationsTest-testInspectProductTo-sequence-diagram.svg" class="align-center" id="index-11" src="../_images/MWVisualizationsTest-testInspectProductTo-sequence-diagram.svg" /></section>
</section>
<section id="quotients-and-remainders">
<h2><span class="section-number">4.3. </span>Quotients and remainders<a class="headerlink" href="#quotients-and-remainders" title="Permalink to this headline">¶</a></h2>
<p>Lets divide <span class="math notranslate nohighlight">\(21\)</span> by <span class="math notranslate nohighlight">\(9\)</span>,</p>
<span class="target" id="pharo-compiledMethod-16"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-teststandardquorem21over9"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testStandardQuoRem21Over9</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">21</span> <span class="nf">/%</span> <span class="m">9</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> <span class="m">21</span> <span class="nf">/</span> <span class="m">9</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testStandardQuoRem21Over9.svg" class="align-center" src="../_images/SymbolicIntegerTest-testStandardQuoRem21Over9.svg" /></div></blockquote>
<p>by means of the binary message</p>
<span class="target" id="pharo-compiledMethod-17"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">/%</span> <span class="nv">anObject</span>

   <span class="o">^</span> <span class="nv">anObject</span> <span class="nf">quoRemInteger:</span> <span class="bp">self</span>
</pre></div>
</div>
<p>that dispatches</p>
<span class="target" id="pharo-compiledMethod-18"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-quoreminteger"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">quoRemInteger:</span> <span class="nv">anInteger</span>

   <span class="o">^</span> <span class="nc">QuoRemStandard</span> <span class="nf">a:</span> <span class="nv">anInteger</span> <span class="nf">b:</span> <span class="bp">self</span>
</pre></div>
</div>
<p>which instantiate a symbolic <code class="docutils literal notranslate"><span class="pre">Magnitude</span></code> object via the class-side message</p>
<span class="target" id="pharo-compiledMethod-19"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-quoremcomplementary-class-a-b"><div class="highlight"><pre><span></span><span class="c">&quot;QuoRemComplementary class, protocol as yet unclassified&quot;</span>
<span class="nf">a:</span> <span class="nv">a</span> <span class="nf">b:</span> <span class="nv">b</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">basicNew</span>
        <span class="nf">a:</span> <span class="nv">a</span><span class="p">;</span>
        <span class="nf">b:</span> <span class="nv">b</span><span class="p">;</span>
        <span class="nf">initialize</span><span class="p">;</span>
        <span class="nf">yourself</span>
</pre></div>
</div>
<p>where both the <em>quotient</em> and the <em>remainder</em> are computed in the overridden</p>
<span class="target" id="pharo-compiledMethod-20"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-quoremstandard-initialize"><div class="highlight"><pre><span></span><span class="c">&quot;QuoRemStandard, protocol accessing&quot;</span>
<span class="nf">initialize</span>

   <span class="bp">super</span> <span class="nf">initialize</span><span class="p">.</span>

   <span class="nv">quo</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">value</span> <span class="nf">floor</span><span class="p">.</span>
   <span class="nv">rem</span> <span class="o">:=</span> <span class="nv">a</span> <span class="nf">-</span> (<span class="nv">quo</span> <span class="nf">*</span> <span class="nv">b</span>)
</pre></div>
</div>
<p>as the usual computation does and the assertion checks in the initial test case.</p>
<p>The same division can be carried out by</p>
<span class="target" id="pharo-compiledMethod-21"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testcomplementaryquorem21over9"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testComplementaryQuoRem21Over9</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">21</span> <span class="nf">/%~</span> <span class="m">9</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> <span class="m">21</span> <span class="nf">/</span> <span class="m">9</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testComplementaryQuoRem21Over9.svg" class="align-center" src="../_images/SymbolicIntegerTest-testComplementaryQuoRem21Over9.svg" /></div></blockquote>
<p>that yields a negative remainder, shown by full dots. To do that, we have the following messages chain</p>
<span class="target" id="pharo-compiledMethod-22"></span><div class="highlight-smalltalk notranslate" id="id5"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">/%~</span> <span class="nv">anObject</span>

   <span class="o">^</span> <span class="nv">anObject</span> <span class="nf">quoRemComplementaryInteger:</span> <span class="bp">self</span>
</pre></div>
</div>
<p>that dispatches</p>
<span class="target" id="pharo-compiledMethod-23"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-quoremcomplementaryinteger"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">quoRemComplementaryInteger:</span> <span class="nv">anInteger</span>

   <span class="o">^</span> <span class="nc">QuoRemComplementary</span> <span class="nf">a:</span> <span class="nv">anInteger</span> <span class="nf">b:</span> <span class="bp">self</span>
</pre></div>
</div>
<p>which instantiate a symbolic <code class="docutils literal notranslate"><span class="pre">Magnitude</span></code> object of class</p>
<span class="target" id="pharo-class-0"></span><div class="highlight-smalltalk notranslate" id="pharo-class-quoremcomplementary"><div class="highlight"><pre><span></span><span class="nc">Magnitude</span> <span class="nf">&lt;&lt;</span> <span class="ss">#QuoRemComplementary</span>
	<span class="nf">slots:</span> { <span class="ss">#a</span> <span class="p">.</span> <span class="ss">#b</span> <span class="p">.</span> <span class="ss">#ratio</span> <span class="p">.</span> <span class="ss">#quo</span> <span class="p">.</span> <span class="ss">#rem</span> }<span class="p">;</span>
	<span class="nf">tag:</span> <span class="s">&#39;Numbers&#39;</span><span class="p">;</span>
	<span class="nf">package:</span> <span class="s">&#39;Containers-Essentials&#39;</span>
</pre></div>
</div>
<p>Both the <em>quotient</em> and the <em>remainder</em> are computed in the initialization message</p>
<span class="target" id="pharo-compiledMethod-24"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-quoremcomplementary-initialize"><div class="highlight"><pre><span></span><span class="c">&quot;QuoRemComplementary, protocol accessing&quot;</span>
<span class="nf">initialize</span>

   <span class="nv">ratio</span> <span class="o">:=</span> <span class="nv">a</span> <span class="nf">/</span> <span class="nv">b</span><span class="p">.</span>

   <span class="nv">quo</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">value</span> <span class="nf">ceiling</span><span class="p">.</span>
   <span class="nv">rem</span> <span class="o">:=</span> <span class="nv">a</span> <span class="nf">-</span> (<span class="nv">quo</span> <span class="nf">*</span> <span class="nv">b</span>)
</pre></div>
</div>
<p>The latter representation is uniform in the sense that it yields a rectangle of dots
that are stacked horizontally, where the number of rows equals the quotient of the division
while the number of columns equals the divisor denoted by the instance variable <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p>
<span class="target" id="pharo-compiledMethod-25"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testcomplementaryquorem9over21"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testComplementaryQuoRem9Over21</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">9</span> <span class="nf">/%~</span> <span class="m">21</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> <span class="m">9</span> <span class="nf">/</span> <span class="m">21</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testComplementaryQuoRem9Over21.svg" class="align-center" src="../_images/SymbolicIntegerTest-testComplementaryQuoRem9Over21.svg" /></div></blockquote>
<span class="target" id="pharo-compiledMethod-26"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testquorem9over21"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testQuoRem9Over21</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">9</span> <span class="nf">/%</span> <span class="m">21</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> <span class="m">9</span> <span class="nf">/</span> <span class="m">21</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testQuoRem9Over21.svg" class="align-center" src="../_images/SymbolicIntegerTest-testQuoRem9Over21.svg" /></div></blockquote>
<span class="target" id="pharo-compiledMethod-27"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testquoremminimal9over21"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testQuoRemMinimal9Over21</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">9</span> <span class="nf">/%&lt;</span> <span class="m">21</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> <span class="m">9</span> <span class="nf">/</span> <span class="m">21</span><span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testQuoRemMinimal9Over21.svg" class="align-center" src="../_images/SymbolicIntegerTest-testQuoRemMinimal9Over21.svg" /></div></blockquote>
</section>
<section id="greatest-common-divisor">
<h2><span class="section-number">4.4. </span>Greatest Common Divisor<a class="headerlink" href="#greatest-common-divisor" title="Permalink to this headline">¶</a></h2>
<span class="target" id="pharo-compiledMethod-28"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdof9and21"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDof9and21</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">9</span> <span class="nf">&gt;|&lt;</span> <span class="m">21</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> (<span class="m">9</span> <span class="nf">gcd:</span> <span class="m">21</span>)<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDof9and21.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDof9and21.svg" /></div></blockquote>
<span class="target" id="pharo-compiledMethod-29"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdof12and21"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDof12and21</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">12</span> <span class="nf">&gt;|&lt;</span> <span class="m">21</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> (<span class="m">12</span> <span class="nf">gcd:</span> <span class="m">21</span>)<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDof12and21.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDof12and21.svg" /></div></blockquote>
</section>
<section id="diophantine-equations">
<h2><span class="section-number">4.5. </span>Diophantine equations<a class="headerlink" href="#diophantine-equations" title="Permalink to this headline">¶</a></h2>
<section id="coprimes">
<h3><span class="section-number">4.5.1. </span>Coprimes<a class="headerlink" href="#coprimes" title="Permalink to this headline">¶</a></h3>
<span class="target" id="pharo-compiledMethod-30"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdof83and71"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDof83and71</span>

   <span class="o">|</span><span class="nv"> quoRem </span><span class="o">|</span>
   <span class="nv">quoRem</span> <span class="o">:=</span> <span class="m">83</span> <span class="nf">&gt;|&lt;</span> <span class="m">71</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">quoRem</span> <span class="nf">equals:</span> (<span class="m">83</span> <span class="nf">gcd:</span> <span class="m">71</span>)<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">quoRem</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDof83and71.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDof83and71.svg" /></div></blockquote>
</section>
<section id="mathbb-z-17-field">
<h3><span class="section-number">4.5.2. </span><span class="math notranslate nohighlight">\(\mathbb{Z}_{17}\)</span> field<a class="headerlink" href="#mathbb-z-17-field" title="Permalink to this headline">¶</a></h3>
<span class="target" id="pharo-compiledMethod-31"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdofz17"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDofZ17</span>

   <span class="o">|</span><span class="nv"> field prime interval </span><span class="o">|</span>
   <span class="nv">prime</span> <span class="o">:=</span> <span class="m">17</span><span class="p">.</span>
   <span class="nv">interval</span> <span class="o">:=</span> <span class="m">1</span> <span class="nf">to:</span> <span class="nv">prime</span> <span class="nf">-</span> <span class="m">1</span><span class="p">.</span>
   <span class="nv">field</span> <span class="o">:=</span> <span class="nv">interval</span> <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">each</span> <span class="nf">&gt;|&lt;</span> <span class="nv">prime</span> ]<span class="p">.</span>

   <span class="bp">self</span>
      <span class="nf">assert:</span> <span class="nv">field</span>
      <span class="nf">equals:</span> (<span class="nv">interval</span> <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">prime</span> <span class="nf">gcd:</span> <span class="nv">each</span> ])<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">field</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDofZ17.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDofZ17.svg" /></div></blockquote>
<span class="target" id="pharo-compiledMethod-32"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdofmultiplicativeinversesinz17"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDofMultiplicativeInversesInZ17</span>

   <span class="o">|</span><span class="nv"> gcds inverses </span><span class="o">|</span>
   <span class="nv">gcds</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">testGCDofZ17</span><span class="p">.</span>
   <span class="nv">inverses</span> <span class="o">:=</span> <span class="nc">PointArray</span> <span class="nf">new:</span> <span class="nv">gcds</span> <span class="nf">size</span><span class="p">.</span>
   <span class="nv">gcds</span> <span class="nf">withIndexDo:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">:</span><span class="nv">index</span> <span class="o">|</span> 
      <span class="nv">inverses</span> <span class="nf">at:</span> <span class="nv">index</span> <span class="nf">put:</span> <span class="nv">each</span> <span class="nf">b</span> <span class="nf">@</span> <span class="nv">each</span> <span class="nf">inverseMultiplicativeOfb</span> <span class="nf">key</span> ]<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">inverses</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDofMultiplicativeInversesInZ17.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDofMultiplicativeInversesInZ17.svg" /></div></blockquote>
</section>
<section id="gcd-f-n-f-n-1-where-f-n-is-the-n-th-fibonacci-number">
<h3><span class="section-number">4.5.3. </span><span class="math notranslate nohighlight">\(GCD(f_{n}, f_{n+1})\)</span>, where <span class="math notranslate nohighlight">\(f_{n}\)</span> is the <span class="math notranslate nohighlight">\(n\)</span>-th Fibonacci number<a class="headerlink" href="#gcd-f-n-f-n-1-where-f-n-is-the-n-th-fibonacci-number" title="Permalink to this headline">¶</a></h3>
<span class="target" id="pharo-compiledMethod-33"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-symbolicintegertest-testgcdofadjacentfibonaccinumbers"><div class="highlight"><pre><span></span><span class="c">&quot;SymbolicIntegerTest, protocol tests&quot;</span>
<span class="nf">testGCDofAdjacentFibonacciNumbers</span>

   <span class="o">|</span><span class="nv"> fibs gcds </span><span class="o">|</span>
   <span class="nv">fibs</span> <span class="o">:=</span> <span class="nc">OrderedCollection</span> <span class="nf">with:</span> <span class="m">1</span> <span class="nf">with:</span> <span class="m">1</span><span class="p">.</span>

   <span class="m">3</span> <span class="nf">to:</span> <span class="m">11</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">i</span> <span class="o">|</span> <span class="nv">fibs</span> <span class="nf">add:</span> (<span class="nv">fibs</span> <span class="nf">at:</span> <span class="nv">i</span> <span class="nf">-</span> <span class="m">2</span>) <span class="nf">+</span> (<span class="nv">fibs</span> <span class="nf">at:</span> <span class="nv">i</span> <span class="nf">-</span> <span class="m">1</span>) ]<span class="p">.</span>

   <span class="nv">gcds</span> <span class="o">:=</span> <span class="nv">fibs</span>
              <span class="nf">with:</span> <span class="nv">fibs</span> <span class="nf">allButFirst</span> <span class="nf">,</span> { (<span class="nv">fibs</span> <span class="nf">lastButOne</span> <span class="nf">+</span> <span class="nv">fibs</span> <span class="nf">last</span>) }
              <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">r</span> <span class="o">:</span><span class="nv">s</span> <span class="o">|</span> <span class="nv">r</span> <span class="nf">&gt;|&lt;</span> <span class="nv">s</span> ]<span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">gcds</span> <span class="nf">equals:</span> (<span class="nv">gcds</span> <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="m">1</span> ])<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">gcds</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/SymbolicIntegerTest-testGCDofAdjacentFibonacciNumbers.svg" class="align-center" src="../_images/SymbolicIntegerTest-testGCDofAdjacentFibonacciNumbers.svg" /></div></blockquote>
</section>
<section id="kissing-fractions">
<span id="kissing-fractions-diophantine"></span><h3><span class="section-number">4.5.4. </span>Kissing <code class="docutils literal notranslate"><span class="pre">Fraction</span></code>s<a class="headerlink" href="#kissing-fractions" title="Permalink to this headline">¶</a></h3>
<p>Consider the <code class="docutils literal notranslate"><span class="pre">Fraction</span></code></p>
<span class="target" id="pharo-compiledMethod-34"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-essentialsobjecttest-testinspectfractionforkisses"><div class="highlight"><pre><span></span><span class="c">&quot;EssentialsObjectTest, protocol tests&quot;</span>
<span class="nf">testInspectFractionForKisses</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="m">4</span> <span class="nf">/</span> <span class="m">17</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/EssentialsObjectTest-testInspectFractionForKisses.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectFractionForKisses.svg" /></div></blockquote>
<p>which kisses other fractions, by tangents of Ford’s circles</p>
<span class="target" id="pharo-compiledMethod-35"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-essentialsobjecttest-testinspectfractionkissing"><div class="highlight"><pre><span></span><span class="c">&quot;EssentialsObjectTest, protocol tests&quot;</span>
<span class="nf">testInspectFractionKissing</span>

   <span class="o">|</span><span class="nv"> aFraction </span><span class="o">|</span>
   <span class="nv">aFraction</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">testInspectFractionForKisses</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">aFraction</span> <span class="nf">kissingFractions</span> <span class="nf">equals:</span> { 
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">5</span>)<span class="p">.</span>
         (<span class="m">2</span> <span class="nf">/</span> <span class="m">9</span>)<span class="p">.</span>
         (<span class="m">3</span> <span class="nf">/</span> <span class="m">13</span>)<span class="p">.</span>
         (<span class="m">4</span> <span class="nf">/</span> <span class="m">17</span>)<span class="p">.</span>
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">4</span>)<span class="p">.</span>
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">3</span>)<span class="p">.</span>
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">2</span>) }<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportShapeOf:</span> <span class="nv">aFraction</span> <span class="nf">accessorBlock:</span> <span class="ss">#asShapeFordCircles</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/EssentialsObjectTest-testInspectFractionKissing.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectFractionKissing.svg" /></div></blockquote>
<p>where</p>
<span class="target" id="pharo-compiledMethod-36"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-fraction-kissingfractions"><div class="highlight"><pre><span></span><span class="c">&quot;Fraction, protocol *Containers-Essentials&quot;</span>
<span class="nf">kissingFractions</span>

   <span class="o">|</span><span class="nv"> kissedFractions vl </span><span class="o">|</span>
   <span class="nv">kissedFractions</span> <span class="o">:=</span> <span class="nc">Set</span> <span class="nb">new</span><span class="p">.</span>

   <span class="nv">vl</span> <span class="o">:=</span> <span class="nc">ValueLink</span> <span class="nb">new</span>
            <span class="nf">value:</span> <span class="bp">self</span> <span class="nf">asFractionWrtFloor</span><span class="p">;</span>
            <span class="nf">yourself</span><span class="p">.</span>

   [ <span class="nv">vl</span> ] <span class="nf">whileNotNil:</span> [ 
      <span class="o">|</span> <span class="nv">gcd</span> <span class="nf">diophantinePoint</span> <span class="nf">next</span> <span class="nf">less</span> <span class="nf">aFraction</span> <span class="nf">|</span>
      <span class="nv">aFraction</span> <span class="o">:=</span> <span class="nv">vl</span> <span class="nf">value</span><span class="p">.</span>
      <span class="nv">kissedFractions</span> <span class="nf">add:</span> <span class="nv">aFraction</span><span class="p">.</span>

      <span class="nv">gcd</span> <span class="o">:=</span> <span class="nv">aFraction</span> <span class="nf">numerator</span> <span class="nf">&gt;|&lt;</span> <span class="nv">aFraction</span> <span class="nf">denominator</span><span class="p">.</span>
      <span class="nv">diophantinePoint</span> <span class="o">:=</span> <span class="nv">gcd</span> <span class="nf">point</span><span class="p">.</span>
      <span class="nv">next</span> <span class="o">:=</span> <span class="nv">diophantinePoint</span> <span class="nf">x</span> <span class="nf">/</span> <span class="nv">diophantinePoint</span> <span class="nf">y</span> <span class="nf">negated</span><span class="p">.</span>

      <span class="nv">less</span> <span class="o">:=</span> <span class="nv">aFraction</span> <span class="nf">numerator</span> <span class="nf">-</span> <span class="nv">next</span> <span class="nf">numerator</span>
              <span class="nf">/</span> (<span class="nv">aFraction</span> <span class="nf">denominator</span> <span class="nf">-</span> <span class="nv">next</span> <span class="nf">denominator</span>)<span class="p">.</span>

      <span class="nv">vl</span> <span class="o">:=</span> <span class="nv">next</span> <span class="nf">kissingFractionLink:</span>
               (<span class="nv">less</span> <span class="nf">kissingFractionLink:</span> <span class="nv">vl</span> <span class="nf">nextLink</span>) ]<span class="p">.</span>

   <span class="o">^</span> <span class="nv">kissedFractions</span> <span class="nf">asArray</span>
        <span class="nf">sort</span><span class="p">;</span>
        <span class="nf">yourself</span>
</pre></div>
</div>
<p>and the polymorphism on <code class="docutils literal notranslate"><span class="pre">#kissingFractionLink:</span></code> reads as follows</p>
<span class="target" id="pharo-compiledMethod-37"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-fraction-kissingfractionlink"><div class="highlight"><pre><span></span><span class="c">&quot;Fraction, protocol *Containers-Essentials&quot;</span>
<span class="nf">kissingFractionLink:</span> <span class="nv">aLink</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">~~&gt;</span> <span class="nv">aLink</span>
</pre></div>
</div>
<span class="target" id="pharo-compiledMethod-38"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-kissingfractionlink"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">kissingFractionLink:</span> <span class="nv">aLink</span>

   <span class="o">^</span> <span class="nv">aLink</span>
</pre></div>
</div>
<p>Moreover, consider the reciprocal</p>
<span class="target" id="pharo-compiledMethod-39"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-essentialsobjecttest-testinspectfractionreciprocalkissing"><div class="highlight"><pre><span></span><span class="c">&quot;EssentialsObjectTest, protocol tests&quot;</span>
<span class="nf">testInspectFractionReciprocalKissing</span>

   <span class="o">|</span><span class="nv"> aFraction </span><span class="o">|</span>
   <span class="nv">aFraction</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">testInspectFractionKissing</span> <span class="nf">reciprocal</span><span class="p">.</span>

   <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">aFraction</span> <span class="nf">kissingFractions</span> <span class="nf">equals:</span> { 
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">4</span>)<span class="p">.</span>
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">3</span>)<span class="p">.</span>
         (<span class="m">1</span> <span class="nf">/</span> <span class="m">2</span>) }<span class="p">.</span>

   <span class="o">^</span> <span class="bp">self</span> <span class="nf">exportShapeOf:</span> <span class="nv">aFraction</span> <span class="nf">accessorBlock:</span> <span class="ss">#asShapeFordCircles</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/EssentialsObjectTest-testInspectFractionReciprocalKissing.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectFractionReciprocalKissing.svg" /></div></blockquote>
<p>which yields a simpler visualization.</p>
</section>
</section>
<section id="skew-binary-canonical-sparse-representation">
<h2><span class="section-number">4.6. </span><em>Skew Binary Canonical</em> sparse representation<a class="headerlink" href="#skew-binary-canonical-sparse-representation" title="Permalink to this headline">¶</a></h2>
<p>Using the conversion message</p>
<span class="target" id="pharo-compiledMethod-40"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-integer-asskewbinarycanonicalsparse"><div class="highlight"><pre><span></span><span class="c">&quot;Integer, protocol *Containers-Essentials&quot;</span>
<span class="nf">asSkewBinaryCanonicalSparse</span>

   <span class="o">|</span><span class="nv"> skew </span><span class="o">|</span>
   <span class="nv">skew</span> <span class="o">:=</span> <span class="nc">SkewBinaryCanonicalNumber</span> <span class="nb">new</span><span class="p">.</span>
   <span class="bp">self</span> <span class="nb">timesRepeat:</span> [ <span class="nv">skew</span> <span class="o">:=</span> <span class="nv">skew</span> <span class="nf">increment</span> ]<span class="p">.</span>
   <span class="o">^</span> <span class="nv">skew</span>
</pre></div>
</div>
<p>we can inspect by means of the test case</p>
<span class="target" id="pharo-compiledMethod-41"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-essentialsobjecttest-testinspectskewbinarycanonicalsparse"><div class="highlight"><pre><span></span><span class="c">&quot;EssentialsObjectTest, protocol tests&quot;</span>
<span class="nf">testInspectSkewBinaryCanonicalSparse</span>

   <span class="o">|</span><span class="nv"> skewNumbers backwards </span><span class="o">|</span>
   <span class="nv">skewNumbers</span> <span class="o">:=</span> (<span class="m">1</span> <span class="nf">to:</span> <span class="m">20</span>) <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> 
                     <span class="nv">each</span> <span class="nf">asSkewBinaryCanonicalSparse</span> <span class="nf">yourself:</span> [ <span class="o">:</span><span class="nv">skew</span> <span class="o">|</span> 
                        <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">skew</span> <span class="nf">asInteger</span> <span class="nf">equals:</span> <span class="nv">each</span> ] ]<span class="p">.</span>

   <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">skewNumbers</span> <span class="nf">pathSuffix:</span> <span class="s">&#39;increasing&#39;</span><span class="p">.</span>

   <span class="nv">backwards</span> <span class="o">:=</span> <span class="nv">skewNumbers</span> <span class="nf">reversed</span>
                   <span class="nf">with:</span> (<span class="m">19</span> <span class="nf">to:</span> <span class="m">0</span> <span class="nf">by:</span> <span class="m">-1</span>)
                   <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">skew</span> <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> 
                      <span class="nv">skew</span> <span class="nf">decrement</span> <span class="nf">yourself:</span> [ <span class="o">:</span><span class="nv">previous</span> <span class="o">|</span> 
                         <span class="bp">self</span> <span class="nf">assert:</span> <span class="nv">previous</span> <span class="nf">asInteger</span> <span class="nf">equals:</span> <span class="nv">each</span> ] ]<span class="p">.</span>

   <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">backwards</span> <span class="nf">pathSuffix:</span> <span class="s">&#39;decreasing&#39;</span>
</pre></div>
</div>
<p>that does its asserts using the backward conversion message,</p>
<span class="target" id="pharo-compiledMethod-42"></span><div class="highlight-smalltalk notranslate" id="pharo-compiledmethod-skewbinarycanonicalnumber-asinteger"><div class="highlight"><pre><span></span><span class="c">&quot;SkewBinaryCanonicalNumber, protocol converting&quot;</span>
<span class="nf">asInteger</span>

   <span class="o">|</span><span class="nv"> value </span><span class="o">|</span>
   <span class="nv">value</span> <span class="o">:=</span> <span class="m">0</span><span class="p">.</span>
   <span class="nv">representation</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">value</span> <span class="o">:=</span> <span class="nv">value</span> <span class="nf">+</span> <span class="nv">each</span> ]<span class="p">.</span>
   <span class="o">^</span> <span class="nv">value</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/EssentialsObjectTest-testInspectSkewBinaryCanonicalSparse-increasing.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectSkewBinaryCanonicalSparse-increasing.svg" /><img alt="../_images/EssentialsObjectTest-testInspectSkewBinaryCanonicalSparse-decreasing.svg" class="align-center" src="../_images/EssentialsObjectTest-testInspectSkewBinaryCanonicalSparse-decreasing.svg" /></div></blockquote>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="bits.html" title="Previous document"><span class="section-number">3. </span>Bits</a>
        </li>
        <li>
          <a href="../linked-allocation/links.html" title="Next document"><span class="section-number">5. </span>Links</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2020, Massimo Nocentini.
      
      |
      <a href="../_sources/symbolic/divisibility.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>