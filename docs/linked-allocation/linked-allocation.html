
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Linked memory allocation &#8212; Data Structures in Smalltalk  documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Data Structures in Smalltalk" href="../index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../index.html" title="Data Structures in Smalltalk"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Data Structures in Smalltalk  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Linked memory allocation</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="linked-memory-allocation">
<h1>Linked memory allocation<a class="headerlink" href="#linked-memory-allocation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="links">
<h2>Links<a class="headerlink" href="#links" title="Permalink to this headline">¶</a></h2>
<div class="section" id="link-objects">
<h3><code class="docutils literal notranslate"><span class="pre">Link</span></code> objects<a class="headerlink" href="#link-objects" title="Permalink to this headline">¶</a></h3>
<p>Our discussion starts with <code class="docutils literal notranslate"><span class="pre">Link</span></code>, a tiny class that is included by default in a fresh image and has been defined as</p>
<span class="target" id="pharo-class-0"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="nc">Object</span> <span class="nf">subclass:</span> <span class="ss">#Link</span>
	<span class="nf">instanceVariableNames:</span> <span class="s">&#39;nextLink&#39;</span>
	<span class="nf">classVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">package:</span> <span class="s">&#39;Collections-Support-Links&#39;</span>

<span class="c">&quot;An instance of me is a simple record of a pointer to another Link. I am an abstract class; my concrete subclasses, for example, Process, can be stored in a LinkedList structure.&quot;</span>
</pre></div>
</div>
<p>The simplest <code class="docutils literal notranslate"><span class="pre">Link</span></code> object is</p>
<span class="target" id="compiledMethod-0"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testEmptyLink</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testEmptyLink.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testEmptyLink.svg" /></div></blockquote>
<p>Although we can use a <code class="docutils literal notranslate"><span class="pre">Link</span></code> to point to an arbitrary object, implicity <code class="docutils literal notranslate"><span class="pre">nil</span></code> in
the previous test case and explicity <code class="docutils literal notranslate"><span class="pre">3</span></code> in the following one,</p>
<span class="target" id="compiledMethod-1"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testLinkReferencingThree</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l</span> <span class="nf">nextLink:</span> <span class="m">3</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testLinkReferencingThree.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testLinkReferencingThree.svg" /></div></blockquote>
<p>a <code class="docutils literal notranslate"><span class="pre">Link</span></code> is designed for referencing a <code class="docutils literal notranslate"><span class="pre">Link</span></code> object, either a new one</p>
<span class="target" id="compiledMethod-2"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testLinkReferencingAnotherLink</span>

	<span class="o">|</span><span class="nv"> l1 l2 </span><span class="o">|</span>
	<span class="nv">l1</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l2</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>

	<span class="nv">l1</span> <span class="nf">nextLink:</span> <span class="nv">l2</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l1</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testLinkReferencingAnotherLink.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testLinkReferencingAnotherLink.svg" /></div></blockquote>
<p>or possibly itself</p>
<span class="target" id="compiledMethod-3"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testLinkReferencingItself</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l</span> <span class="nf">nextLink:</span> <span class="nv">l</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testLinkReferencingItself.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testLinkReferencingItself.svg" /></div></blockquote>
<p>The previous two representations look the same but in memory are completely
different structures. To see this, we unroll the representation for the <code class="docutils literal notranslate"><span class="pre">Link</span></code>
objects that are <em>recursively</em> referenced via the <code class="docutils literal notranslate"><span class="pre">nextLink</span></code> slot so that
both the usual structure</p>
<span class="target" id="compiledMethod-4"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testLinkReferencingAnotherLinkRecursive</span>

	<span class="o">|</span><span class="nv"> l1 l2 </span><span class="o">|</span>
	<span class="nv">l1</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l2</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>

	<span class="nv">l1</span> <span class="nf">nextLink:</span> <span class="nv">l2</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="nv">l1</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testLinkReferencingAnotherLinkRecursive.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testLinkReferencingAnotherLinkRecursive.svg" /></div></blockquote>
<p>and the loop structure</p>
<span class="target" id="compiledMethod-5"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testLinkReferencingItselfRecursive</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l</span> <span class="nf">nextLink:</span> <span class="nv">l</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testLinkReferencingItselfRecursive.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testLinkReferencingItselfRecursive.svg" /></div></blockquote>
<p>are correcly drawn and the difference is now clear.  From now on we will use
the recursive representation in order to have the big picture of the structures
allocated in memory, so a combination of what we have seen so far looks as
follows</p>
<span class="target" id="compiledMethod-6"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageLinkTest, protocol tests&quot;</span>
<span class="nf">testTwoLinksReferencingEachOtherRecursive</span>

	<span class="o">|</span><span class="nv"> l1 l2 l3 </span><span class="o">|</span>
	<span class="nv">l1</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l2</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l3</span> <span class="o">:=</span> <span class="nc">Link</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">l1</span> <span class="nf">nextLink:</span> <span class="nv">l2</span><span class="p">.</span>
	<span class="nv">l2</span> <span class="nf">nextLink:</span> <span class="nv">l3</span><span class="p">.</span>
	<span class="nv">l3</span> <span class="nf">nextLink:</span> <span class="nv">l1</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="nv">l1</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageLinkTest-testTwoLinksReferencingEachOtherRecursive.svg" class="align-center" src="../_images/CTLinkedStorageLinkTest-testTwoLinksReferencingEachOtherRecursive.svg" /></div></blockquote>
</div>
<div class="section" id="valuelink-objects">
<h3><code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> objects<a class="headerlink" href="#valuelink-objects" title="Permalink to this headline">¶</a></h3>
<p>With the addition of the <code class="docutils literal notranslate"><span class="pre">value</span></code> slot to the <code class="docutils literal notranslate"><span class="pre">Link</span></code> class we obtain the
<code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> class, precisely</p>
<span class="target" id="pharo-class-1"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="nc">Link</span> <span class="nf">subclass:</span> <span class="ss">#ValueLink</span>
	<span class="nf">instanceVariableNames:</span> <span class="s">&#39;value&#39;</span>
	<span class="nf">classVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">package:</span> <span class="s">&#39;Collections-Support-Links&#39;</span>

<span class="c">&quot;A ValueLink is a Link containing a Value.</span>
<span class="c">Adding an object to a LinkedList which is not a Link will create a ValueLink containing that object.</span>


<span class="c">value - The object this link points to.&quot;</span>
</pre></div>
</div>
<p>and the binary message</p>
<span class="target" id="compiledMethod-7"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Object, protocol associating&quot;</span>
<span class="nf">~~&gt;</span> <span class="nv">aValueLinkOrNil</span>

	<span class="c">&quot;Answer a ValueLink between self and aValueLinkOrNil.</span>
<span class="c">	This message allows the receiver to be inserted in a chain of objects, terminated by nil.&quot;</span>

	<span class="c">&quot;Code of ValueLink&gt;&gt;#nextLink: and ValueLink&gt;&gt;#value: are inline here for speed.&quot;</span>

	<span class="c">&quot;(1 ~~&gt; nil) = ValueLink new value: 1&quot;</span>

	<span class="c">&quot;(1 ~~&gt; &#39;one&#39;) value &gt;&gt;&gt; 1&quot;</span>

	<span class="c">&quot;(1 ~~&gt; nil) nextLink &gt;&gt;&gt; nil&quot;</span>

	<span class="c">&quot;Note that `value` can be ANY object; on the other hand, `nextLink` should be either another </span>
<span class="c">	ValueLink object or nil.&quot;</span>

	<span class="o">^</span> <span class="nc">ValueLink</span> <span class="nf">basicNew</span>
		  <span class="nf">value:</span> <span class="bp">self</span><span class="p">;</span>
		  <span class="nf">nextLink:</span> <span class="nv">aValueLinkOrNil</span><span class="p">;</span>
		  <span class="nf">yourself</span>
</pre></div>
</div>
<p>allows us to build a simple <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> as</p>
<span class="target" id="compiledMethod-8"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testSimpleValueLink</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">1</span> <span class="nf">~~&gt;</span> <span class="bp">nil</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testSimpleValueLink.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testSimpleValueLink.svg" /></div></blockquote>
<p>Of course, we can compose the application of <code class="docutils literal notranslate"><span class="pre">#~~&gt;</span></code> to build an arbitrary long chain as</p>
<span class="target" id="compiledMethod-9"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test21ValueLinks</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">2</span> <span class="nf">~~&gt;</span> <span class="bp">self</span> <span class="nf">testSimpleValueLink</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test21ValueLinks.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test21ValueLinks.svg" /></div></blockquote>
<span class="target" id="compiledMethod-10"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test321ValueLinks</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">3</span> <span class="nf">~~&gt;</span> <span class="bp">self</span> <span class="nf">test21ValueLinks</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test321ValueLinks.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test321ValueLinks.svg" /></div></blockquote>
<span class="target" id="compiledMethod-11"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test4321ValueLinks</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">4</span> <span class="nf">~~&gt;</span> <span class="bp">self</span> <span class="nf">test321ValueLinks</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinks.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinks.svg" /></div></blockquote>
<p>Moreover, using the recursive representation we can have a look at all of them in one shot</p>
<span class="target" id="compiledMethod-12"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test4321ValueLinksRecursive</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="bp">self</span> <span class="nf">test4321ValueLinks</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinksRecursive.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinksRecursive.svg" /></div></blockquote>
<p>and in a simpler form</p>
<span class="target" id="compiledMethod-13"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test4321ValueLinksSimplerRepr</span>

	<span class="o">^</span> <span class="bp">self</span>
		  <span class="nf">export:</span> <span class="bp">self</span> <span class="nf">test4321ValueLinks</span>
		  <span class="nf">pathSuffix:</span> <span class="s">&#39;&#39;</span>
		  <span class="nf">selector:</span> <span class="ss">#gtInspectorLinksUsingCanvas:</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinksSimplerRepr.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test4321ValueLinksSimplerRepr.svg" /></div></blockquote>
<p>As we have seen for <code class="docutils literal notranslate"><span class="pre">Link</span></code> objects, we can build a loop with <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code>
objects too, both implicitly</p>
<span class="target" id="compiledMethod-14"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test11ValueLinksLoop</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">1</span> <span class="nf">~~&gt;</span> <span class="bp">nil</span><span class="p">.</span>
	<span class="nv">l</span> <span class="nf">nextLink:</span> <span class="nv">l</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test11ValueLinksLoop.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test11ValueLinksLoop.svg" /></div></blockquote>
<p>and explicitly</p>
<span class="target" id="compiledMethod-15"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test11ValueLinksLoopRecursive</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="bp">self</span> <span class="nf">test11ValueLinksLoop</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test11ValueLinksLoopRecursive.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test11ValueLinksLoopRecursive.svg" /></div></blockquote>
<p>Finally, a combination of the constructions given before looks as follows</p>
<span class="target" id="compiledMethod-16"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test43214ValueLinksRecursive</span>

	<span class="o">|</span><span class="nv"> l1 l </span><span class="o">|</span>
	<span class="nv">l1</span> <span class="o">:=</span> <span class="m">1</span> <span class="nf">~~&gt;</span> <span class="bp">nil</span><span class="p">.</span>
	<span class="nv">l</span> <span class="o">:=</span> <span class="m">4</span> <span class="nf">~~&gt;</span> (<span class="m">3</span> <span class="nf">~~&gt;</span> (<span class="m">2</span> <span class="nf">~~&gt;</span> <span class="nv">l1</span>))<span class="p">.</span>
	<span class="nv">l1</span> <span class="nf">nextLink:</span> <span class="nv">l</span><span class="p">.</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test43214ValueLinksRecursive.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test43214ValueLinksRecursive.svg" /></div></blockquote>
<p>and since we are in a loop, we can just skip a few times to get a different but
equivalent representation</p>
<span class="target" id="compiledMethod-17"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">test43214ValueLinksFrom2Recursive</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span>
		  <span class="bp">self</span> <span class="nf">test43214ValueLinksRecursive</span> <span class="nf">nextLink</span> <span class="nf">nextLink</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-test43214ValueLinksFrom2Recursive.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-test43214ValueLinksFrom2Recursive.svg" /></div></blockquote>
<div class="section" id="test-case-topological-sorting">
<span id="index-0"></span><h4>Test case: Topological sorting<a class="headerlink" href="#test-case-topological-sorting" title="Permalink to this headline">¶</a></h4>
<p>Implementation of the <em>Algorithm T</em> in TAOCP by Donald Knuth, Volume 1 page 264.</p>
<p>The complexity is <span class="math notranslate nohighlight">\(O(m + n)\)</span> where <span class="math notranslate nohighlight">\(m\)</span> is the number of input
relations and <span class="math notranslate nohighlight">\(n\)</span> is the number of (unique) objects represented by
naturals.  The message send <code class="docutils literal notranslate"><span class="pre">c</span> <span class="pre">topologicalSortOnCycleDo:</span> <span class="pre">b</span></code>, where <code class="docutils literal notranslate"><span class="pre">c</span></code> is a
collection of associations <span class="math notranslate nohighlight">\((j, k) \in [1, n]^{2}\)</span> no holes allowed,
namely every natural <em>has</em> to be used in at least one input relation. And,
<code class="docutils literal notranslate"><span class="pre">b</span></code> is a block consuming a collection of associations forming a cycle.</p>
<span class="target" id="compiledMethod-21"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-LinkedStoragePool-Examples&quot;</span>
<span class="nf">topologicalSortByAssociations:</span> <span class="nv">aRelation</span> <span class="nf">onCycleDo:</span> <span class="nv">cBlock</span>

	<span class="o">|</span><span class="nv"> sorter </span><span class="o">|</span>
	<span class="nv">sorter</span> <span class="o">:=</span> <span class="nc">TopologicalSortAlgorithm</span> <span class="nb">new</span>
		          <span class="nf">size:</span> <span class="bp">self</span> <span class="nf">size</span><span class="p">;</span>
		          <span class="nf">relation:</span> <span class="nv">aRelation</span><span class="p">;</span>
		          <span class="nf">yourself</span><span class="p">.</span>
	<span class="o">^</span> <span class="nv">sorter</span>
		  <span class="nf">value:</span> [ <span class="o">:</span><span class="nv">ordering</span> <span class="o">|</span> 
			  <span class="bp">self</span> <span class="nf">species</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">aStream</span> <span class="o">|</span> 
				  <span class="nv">ordering</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">anIndex</span> <span class="o">|</span> <span class="nv">aStream</span> <span class="nf">nextPut:</span> (<span class="bp">self</span> <span class="nf">at:</span> <span class="nv">anIndex</span>) ] ] ]
		  <span class="nf">onCycleDo:</span> [ <span class="o">:</span><span class="nv">cycle</span> <span class="o">|</span> 
			  <span class="o">|</span><span class="nv"> sequence </span><span class="o">|</span>
			  <span class="nv">sequence</span> <span class="o">:=</span> <span class="nc">Array</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">aStream</span> <span class="o">|</span> 
				              <span class="nv">aStream</span> <span class="nf">nextPut:</span> (<span class="bp">self</span> <span class="nf">at:</span> <span class="nv">cycle</span> <span class="nf">first</span> <span class="nf">key</span>)<span class="p">.</span>
				              <span class="nv">cycle</span> <span class="nf">reverseDo:</span> [ <span class="o">:</span><span class="nv">anAssoc</span> <span class="o">|</span> 
					              <span class="nv">aStream</span> <span class="nf">nextPut:</span> (<span class="bp">self</span> <span class="nf">at:</span> <span class="nv">anAssoc</span> <span class="nf">key</span>) ] ]<span class="p">.</span>
			  <span class="nv">cBlock</span> <span class="nf">cull:</span> <span class="nv">sequence</span> <span class="nf">cull:</span> <span class="nv">cycle</span> ]
</pre></div>
</div>
<blockquote>
<div><p>where</p>
<span class="target" id="compiledMethod-18"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;TopologicalSortAlgorithm, protocol enumerating&quot;</span>
<span class="nf">value:</span> <span class="nv">aBlock</span> <span class="nf">onCycleDo:</span> <span class="nv">cycleBlock</span>

	<span class="o">|</span><span class="nv"> table r qlink f sort </span><span class="o">|</span>
	<span class="c">&quot;T1: initialize.&quot;</span>
	<span class="nv">table</span> <span class="o">:=</span> (<span class="m">1</span> <span class="nf">to:</span> <span class="nv">size</span>) <span class="nf">collect:</span> [ <span class="o">:</span><span class="nv">k</span> <span class="o">|</span> 
		         <span class="nc">Association</span> <span class="nb">new</span>
			         <span class="nf">key:</span> <span class="m">0</span><span class="p">;</span>
			         <span class="c">&quot;COUNT: the number of direct predecessors of this object.&quot;</span>
			         <span class="nf">value:</span> <span class="bp">nil</span><span class="p">;</span>
			         <span class="c">&quot;TOP: link to the beginning of the list of direct successors of this object.&quot;</span>
				         <span class="nf">yourself</span> ]<span class="p">.</span>

	<span class="c">&quot;T2: next relation.&quot;</span>
	<span class="nv">relation</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">anAssoc</span> <span class="o">|</span> 
		<span class="o">|</span><span class="nv"> j k </span><span class="o">|</span>
		<span class="c">&quot;Unpack `relation` such that `relation = (j -&gt; k)` holds.&quot;</span>
		<span class="nv">j</span> <span class="o">:=</span> <span class="nv">anAssoc</span> <span class="nf">key</span><span class="p">.</span>
		<span class="nv">k</span> <span class="o">:=</span> <span class="nv">anAssoc</span> <span class="nf">value</span><span class="p">.</span>

		<span class="c">&quot;T3: Increase COUNT by one.&quot;</span>
		(<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">k</span>) <span class="nf">in:</span> [ <span class="o">:</span><span class="nv">destAssoc</span> <span class="o">|</span> <span class="nv">destAssoc</span> <span class="nf">key:</span> <span class="nv">destAssoc</span> <span class="nf">key</span> <span class="nf">+</span> <span class="m">1</span> ]<span class="p">.</span>

		<span class="c">&quot;T3: record the relation.&quot;</span>
		(<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">j</span>) <span class="nf">in:</span> [ <span class="o">:</span><span class="nv">sourceAssoc</span> <span class="o">|</span> <span class="c">&quot;Operation (8)&quot;</span> 
			<span class="nv">sourceAssoc</span> <span class="nf">value:</span> <span class="nv">k</span> <span class="nf">~~&gt;</span> <span class="nv">sourceAssoc</span> <span class="nf">value</span> ] ]<span class="p">.</span>

	<span class="c">&quot;T4: scan for zeros.&quot;</span>
	<span class="nv">qlink</span> <span class="o">:=</span> <span class="nc">Dictionary</span> <span class="nb">new</span><span class="p">.</span>
	<span class="nv">r</span> <span class="o">:=</span> <span class="m">0</span><span class="p">.</span>
	<span class="m">1</span> <span class="nf">to:</span> <span class="nv">size</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">k</span> <span class="o">|</span> 
		<span class="o">|</span><span class="nv"> count </span><span class="o">|</span>
		<span class="nv">count</span> <span class="o">:=</span> (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">k</span>) <span class="nf">key</span><span class="p">.</span>
		<span class="nv">count</span> <span class="nf">=</span> <span class="m">0</span> <span class="nb">ifTrue:</span> [ <span class="nv">r</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">r</span> <span class="nf">put:</span> <span class="nv">k</span> ] ]<span class="p">.</span>
	<span class="nv">f</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="m">0</span> <span class="nf">ifAbsent:</span> [ <span class="m">0</span> ]<span class="p">.</span>
	<span class="nv">sort</span> <span class="o">:=</span> <span class="nc">Array</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">array</span> <span class="o">|</span> 
		        [ <span class="nv">f</span> <span class="nf">=</span> <span class="m">0</span> ] <span class="nb">whileFalse:</span> [ 
			        <span class="o">|</span> <span class="nv">p</span> <span class="nf">|</span>
			        <span class="c">&quot;T5: output front of queue.&quot;</span>
			        <span class="nv">array</span> <span class="nf">nextPut:</span> <span class="nv">f</span><span class="p">.</span>

			        <span class="nv">p</span> <span class="o">:=</span> (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">f</span>) <span class="nf">in:</span> [ <span class="o">:</span><span class="nv">assoc</span> <span class="o">|</span> 
				             <span class="nv">assoc</span> <span class="nf">value</span> <span class="nf">ignoreBlock:</span> [ <span class="nv">assoc</span> <span class="nf">value:</span> <span class="bp">nil</span> ] ]<span class="p">.</span>

			        <span class="c">&quot;T6: erase relations.&quot;</span>
			        [ <span class="nv">p</span> ] <span class="nf">whileNotNil:</span> [ 
				        <span class="o">|</span> <span class="nv">assoc</span> <span class="nf">k</span> <span class="nf">count</span> <span class="nf">|</span>
				        <span class="nv">k</span> <span class="o">:=</span> <span class="nv">p</span> <span class="nf">value</span><span class="p">.</span>
				        <span class="nv">assoc</span> <span class="o">:=</span> <span class="nv">table</span> <span class="nf">at:</span> <span class="nv">k</span><span class="p">.</span>
				        <span class="nv">count</span> <span class="o">:=</span> <span class="nv">assoc</span>
					                 <span class="nf">key:</span> <span class="nv">assoc</span> <span class="nf">key</span> <span class="nf">-</span> <span class="m">1</span><span class="p">;</span>
					                 <span class="nf">key</span><span class="p">.</span> <span class="c">&quot;decrease COUNT by one.&quot;</span>
				        <span class="nv">count</span> <span class="nf">=</span> <span class="m">0</span> <span class="nb">ifTrue:</span> [ <span class="nv">r</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">r</span> <span class="nf">put:</span> <span class="nv">k</span> ]<span class="p">.</span>
				        <span class="nv">p</span> <span class="o">:=</span> <span class="nv">p</span> <span class="nf">nextLink</span> ]<span class="p">.</span>

			        <span class="c">&quot;T7: remove from queue.&quot;</span>
			        <span class="nv">f</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">f</span> <span class="nf">ifAbsent:</span> [ <span class="m">0</span> ] ] ]<span class="p">.</span>
	<span class="o">^</span> <span class="nv">sort</span> <span class="nf">size</span> <span class="nf">&lt;</span> <span class="nv">size</span>
		  <span class="nb">ifTrue:</span> [ 
			  <span class="o">|</span> <span class="nv">kk</span> <span class="nf">cycle</span> <span class="nf">|</span>
			  <span class="c">&quot;T9&quot;</span>
			  <span class="nv">qlink</span> <span class="o">:=</span> <span class="nc">Dictionary</span> <span class="nb">new</span><span class="p">.</span>
			  <span class="m">1</span> <span class="nf">to:</span> <span class="nv">size</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">k</span> <span class="o">|</span> 
				  <span class="o">|</span><span class="nv"> assoc p </span><span class="o">|</span>
				  <span class="nv">assoc</span> <span class="o">:=</span> <span class="nv">table</span> <span class="nf">at:</span> <span class="nv">k</span><span class="p">.</span>
				  <span class="nv">p</span> <span class="o">:=</span> <span class="nv">assoc</span> <span class="nf">value</span> <span class="nf">ignoreBlock:</span> [ <span class="nv">assoc</span> <span class="nf">value:</span> <span class="m">0</span> ]<span class="p">.</span>

				  <span class="c">&quot;T10&quot;</span>
				  [ <span class="nv">p</span> ] <span class="nf">whileNotNil:</span> [ 
					  <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">p</span> <span class="nf">value</span> <span class="nf">put:</span> <span class="nv">k</span><span class="p">.</span>
					  <span class="nv">p</span> <span class="o">:=</span> <span class="nv">p</span> <span class="nf">nextLink</span> ] ]<span class="p">.</span>

			  <span class="c">&quot;T11&quot;</span>
			  <span class="nv">kk</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">anyAssociation</span> <span class="nf">key</span><span class="p">.</span>

			  <span class="c">&quot;T12&quot;</span>
			  [ 
			  (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">kk</span>) <span class="nf">value:</span> <span class="m">1</span><span class="p">.</span>
			  <span class="nv">kk</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">kk</span><span class="p">.</span>
			  (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">kk</span>) <span class="nf">value</span> <span class="nf">=</span> <span class="m">0</span> ] <span class="nf">whileTrue</span><span class="p">.</span>

			  <span class="c">&quot;T13&quot;</span>
			  <span class="nv">cycle</span> <span class="o">:=</span> <span class="nc">Array</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">array</span> <span class="o">|</span> 
				           [ 
				           <span class="nv">array</span> <span class="nf">nextPut:</span> <span class="nv">kk</span><span class="p">.</span>
				           (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">kk</span>) <span class="nf">value:</span> <span class="m">0</span><span class="p">.</span>
				           <span class="nv">kk</span> <span class="o">:=</span> <span class="nv">qlink</span> <span class="nf">at:</span> <span class="nv">kk</span><span class="p">.</span>
				           (<span class="nv">table</span> <span class="nf">at:</span> <span class="nv">kk</span>) <span class="nf">value</span> <span class="nf">=</span> <span class="m">1</span> ] <span class="nf">whileTrue</span><span class="p">.</span>
				           <span class="nv">array</span> <span class="nf">nextPut:</span> <span class="nv">kk</span> ]<span class="p">.</span>

			  <span class="c">&quot;Invoke the given block with the detected cycle.&quot;</span>
			  <span class="nv">cycleBlock</span> <span class="nf">value:</span>
				  (<span class="nv">cycle</span> <span class="nf">overlappingPairsCollect:</span> [ <span class="o">:</span><span class="nv">a</span> <span class="o">:</span><span class="nv">b</span> <span class="o">|</span> <span class="nv">b</span> <span class="nf">-&gt;</span> <span class="nv">a</span> ]) ]
		  <span class="nb">ifFalse:</span> [ <span class="nv">aBlock</span> <span class="nf">value:</span> <span class="nv">sort</span> ]
</pre></div>
</div>
<p>where</p>
<blockquote>
<div><span class="target" id="compiledMethod-19"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Object, protocol *Kernel-Extensions&quot;</span>
<span class="nf">ignoreBlock:</span> <span class="nv">aBlock</span>

	<span class="c">&quot;I invoke the given block giving myself as argument if it needs to consume me.</span>
<span class="c">	 Then I return my self discarding the value returned by the given block.&quot;</span>

	<span class="nv">aBlock</span> <span class="nf">cull:</span> <span class="bp">self</span><span class="p">.</span>
	<span class="o">^</span> <span class="bp">self</span>
</pre></div>
</div>
<p>and</p>
<span class="target" id="compiledMethod-20"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Dictionary, protocol *Collections-Unordered-Extensions&quot;</span>
<span class="nf">anyAssociation</span>

	<span class="c">&quot;I mimic the message `Collection&gt;&gt;#anyone` with respect to associations that I collect.&quot;</span>

	<span class="bp">self</span>
		<span class="nf">emptyCheck</span><span class="p">;</span>
		<span class="nf">associationsDo:</span> [ <span class="o">:</span><span class="nv">assoc</span> <span class="o">|</span> <span class="o">^</span> <span class="nv">assoc</span> ]
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>Testing for acyclic property can be done with the following message:</p>
<span class="target" id="compiledMethod-22"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-LinkedStoragePool-Examples&quot;</span>
<span class="nf">isAcyclicWithRespectToAssociations:</span> <span class="nv">aRelation</span>

	<span class="o">|</span><span class="nv"> isAcyclic </span><span class="o">|</span>
	<span class="nv">isAcyclic</span> <span class="o">:=</span> <span class="bp">true</span><span class="p">.</span>
	<span class="bp">self</span>
		<span class="nf">topologicalSortByAssociations:</span> <span class="nv">aRelation</span>
		<span class="nf">onCycleDo:</span> [ <span class="nv">isAcyclic</span> <span class="o">:=</span> <span class="bp">false</span> ]<span class="p">.</span>
	<span class="o">^</span> <span class="nv">isAcyclic</span>
</pre></div>
</div>
<p>Some tests are in order:</p>
<span class="target" id="compiledMethod-23"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CollectionTest, protocol *Containers-LinkedStoragePool-Tests&quot;</span>
<span class="nf">testTopologicalSortOnCycleDo</span>

	<span class="c">&quot;The following test is kept from TAOCP by Donald Knuth, Volume 1 page 272.&quot;</span>

	<span class="bp">self</span>
		<span class="nf">assert:</span> ((<span class="m">1</span> <span class="nf">to:</span> <span class="m">9</span>)
				 <span class="nf">topologicalSortByAssociations:</span> { 
						 (<span class="m">9</span> <span class="nf">-&gt;</span> <span class="m">2</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">7</span>)<span class="p">.</span>
						 (<span class="m">7</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
						 (<span class="m">5</span> <span class="nf">-&gt;</span> <span class="m">8</span>)<span class="p">.</span>
						 (<span class="m">8</span> <span class="nf">-&gt;</span> <span class="m">6</span>)<span class="p">.</span>
						 (<span class="m">4</span> <span class="nf">-&gt;</span> <span class="m">6</span>)<span class="p">.</span>
						 (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">3</span>)<span class="p">.</span>
						 (<span class="m">7</span> <span class="nf">-&gt;</span> <span class="m">4</span>)<span class="p">.</span>
						 (<span class="m">9</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">8</span>) }
				 <span class="nf">onCycleDo:</span> [ <span class="nc">Error</span> <span class="nf">signal</span> ])
		<span class="nf">equals:</span> <span class="ss">#(</span> <span class="m">1</span> <span class="m">9</span> <span class="m">3</span> <span class="m">2</span> <span class="m">7</span> <span class="m">4</span> <span class="m">5</span> <span class="m">8</span> <span class="m">6</span> <span class="ss">)</span>
</pre></div>
</div>
<span class="target" id="compiledMethod-24"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CollectionTest, protocol *Containers-LinkedStoragePool-Tests&quot;</span>
<span class="nf">testTopologicalSortOnCycleDo1</span>

	<span class="c">&quot;This test stress four small cycles detection.&quot;</span>

	<span class="o">|</span><span class="nv"> cycleBlock </span><span class="o">|</span>
	<span class="nv">cycleBlock</span> <span class="o">:=</span> [ <span class="o">:</span><span class="nv">sequence</span> <span class="o">:</span><span class="nv">cycle</span> <span class="o">|</span> <span class="nv">sequence</span> <span class="nf">,</span> <span class="nv">cycle</span> ]<span class="p">.</span>
	<span class="bp">self</span>
		<span class="nf">assert:</span> ({ <span class="ss">#a</span> }
				 <span class="nf">topologicalSortByAssociations:</span> { (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">1</span>) }
				 <span class="nf">onCycleDo:</span> <span class="nv">cycleBlock</span>)
		<span class="nf">equals:</span> { 
				<span class="ss">#a</span><span class="p">.</span>
				<span class="ss">#a</span><span class="p">.</span>
				(<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">1</span>) }<span class="p">.</span>
	<span class="bp">self</span>
		<span class="nf">assert:</span> ({ <span class="ss">#a</span><span class="p">.</span> <span class="ss">#b</span> }
				 <span class="nf">topologicalSortByAssociations:</span> { 
						 (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">1</span>) }
				 <span class="nf">onCycleDo:</span> <span class="nv">cycleBlock</span>)
		<span class="nf">equals:</span> { 
				<span class="ss">#b</span><span class="p">.</span>
				<span class="ss">#a</span><span class="p">.</span>
				<span class="ss">#b</span><span class="p">.</span>
				(<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">1</span>)<span class="p">.</span>
				(<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>) }<span class="p">.</span>
	<span class="bp">self</span>
		<span class="nf">assert:</span> ({ <span class="ss">#a</span><span class="p">.</span> <span class="ss">#b</span><span class="p">.</span> <span class="ss">#c</span> }
				 <span class="nf">topologicalSortByAssociations:</span> { 
						 (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">3</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">1</span>) }
				 <span class="nf">onCycleDo:</span> <span class="nv">cycleBlock</span>)
		<span class="nf">equals:</span> { 
				<span class="ss">#c</span><span class="p">.</span>
				<span class="ss">#a</span><span class="p">.</span>
				<span class="ss">#b</span><span class="p">.</span>
				<span class="ss">#c</span><span class="p">.</span>
				(<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">1</span>)<span class="p">.</span>
				(<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">3</span>)<span class="p">.</span>
				(<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>) }<span class="p">.</span>
	<span class="bp">self</span>
		<span class="nf">assert:</span> ({ <span class="ss">#a</span><span class="p">.</span> <span class="ss">#b</span><span class="p">.</span> <span class="ss">#c</span><span class="p">.</span> <span class="ss">#d</span><span class="p">.</span> <span class="ss">#e</span> }
				 <span class="nf">topologicalSortByAssociations:</span> { 
						 (<span class="m">5</span> <span class="nf">-&gt;</span> <span class="m">1</span>)<span class="p">.</span>
						 (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">3</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">4</span>) }
				 <span class="nf">onCycleDo:</span> <span class="nv">cycleBlock</span>)
		<span class="nf">equals:</span> { 
				<span class="ss">#e</span><span class="p">.</span>
				<span class="ss">#a</span><span class="p">.</span>
				<span class="ss">#b</span><span class="p">.</span>
				<span class="ss">#c</span><span class="p">.</span>
				<span class="ss">#e</span><span class="p">.</span>
				(<span class="m">5</span> <span class="nf">-&gt;</span> <span class="m">1</span>)<span class="p">.</span>
				(<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
				(<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">3</span>)<span class="p">.</span>
				(<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">2</span>) }
</pre></div>
</div>
<span class="target" id="compiledMethod-25"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CollectionTest, protocol *Containers-LinkedStoragePool-Tests&quot;</span>
<span class="nf">testTopologicalSortOnCycleDo2</span>

	<span class="c">&quot;The following test is kept from https://upload.wikimedia.org/wikipedia/commons/0/03/Directed_acyclic_graph_2.svg.&quot;</span>

	<span class="bp">self</span>
		<span class="nf">assert:</span> ((<span class="m">1</span> <span class="nf">to:</span> <span class="m">8</span>)
				 <span class="nf">topologicalSortByAssociations:</span> { 
						 (<span class="m">1</span> <span class="nf">-&gt;</span> <span class="m">4</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">4</span>)<span class="p">.</span>
						 (<span class="m">2</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">5</span>)<span class="p">.</span>
						 (<span class="m">3</span> <span class="nf">-&gt;</span> <span class="m">8</span>)<span class="p">.</span>
						 (<span class="m">4</span> <span class="nf">-&gt;</span> <span class="m">6</span>)<span class="p">.</span>
						 (<span class="m">4</span> <span class="nf">-&gt;</span> <span class="m">7</span>)<span class="p">.</span>
						 (<span class="m">4</span> <span class="nf">-&gt;</span> <span class="m">8</span>)<span class="p">.</span>
						 (<span class="m">5</span> <span class="nf">-&gt;</span> <span class="m">7</span>) }
				 <span class="nf">onCycleDo:</span> [ <span class="nc">Error</span> <span class="nf">signal</span> ])
		<span class="nf">equals:</span> <span class="ss">#(</span> <span class="m">1</span> <span class="m">2</span> <span class="m">3</span> <span class="m">4</span> <span class="m">5</span> <span class="m">8</span> <span class="m">6</span> <span class="m">7</span> <span class="ss">)</span>
</pre></div>
</div>
<span class="target" id="compiledMethod-27"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CollectionTest, protocol *Containers-LinkedStoragePool-Tests&quot;</span>
<span class="nf">testTopologicalSortOnCycleDo3</span>

	<span class="c">&quot;This test case shows how to iteratively removing edges</span>
<span class="c">	 belonging to a cycle to yield an acyclic relation.&quot;</span>

	<span class="o">|</span><span class="nv"> aRelation m </span><span class="o">|</span>
	<span class="nv">m</span> <span class="o">:=</span> <span class="m">100</span><span class="p">.</span>
	<span class="nv">aRelation</span> <span class="o">:=</span> <span class="bp">self</span> <span class="nf">randomRelationOfSize:</span> <span class="m">1000</span> <span class="nf">max:</span> <span class="nv">m</span><span class="p">.</span>

	(<span class="m">1</span> <span class="nf">to:</span> <span class="nv">m</span>)
		<span class="nf">topologicalSortByAssociations:</span> <span class="nv">aRelation</span>
		<span class="nf">acyclicDo:</span> [ <span class="o">:</span><span class="nv">ordering</span> <span class="o">:</span><span class="nv">edges</span> <span class="o">|</span> 
			<span class="bp">self</span>
				<span class="nf">assert:</span> <span class="nv">ordering</span>
				<span class="nf">equals:</span>
					<span class="ss">#(</span> <span class="m">60</span> <span class="m">73</span> <span class="m">86</span> <span class="m">94</span> <span class="m">95</span> <span class="m">99</span> <span class="m">100</span> <span class="m">57</span> <span class="m">96</span> <span class="m">90</span> <span class="m">87</span> <span class="m">98</span> <span class="m">82</span> <span class="m">80</span> <span class="m">64</span> <span class="m">1</span> <span class="m">88</span> <span class="m">89</span> <span class="m">84</span> <span class="m">92</span> <span class="m">93</span>
					   <span class="m">15</span> <span class="m">2</span> <span class="m">69</span> <span class="m">97</span> <span class="m">41</span> <span class="m">63</span> <span class="m">67</span> <span class="m">81</span> <span class="m">76</span> <span class="m">7</span> <span class="m">75</span> <span class="m">44</span> <span class="m">68</span> <span class="m">37</span> <span class="m">3</span> <span class="m">65</span> <span class="m">47</span> <span class="m">70</span> <span class="m">66</span> <span class="m">85</span> <span class="m">91</span> <span class="m">71</span>
					   <span class="m">59</span> <span class="m">4</span> <span class="m">62</span> <span class="m">77</span> <span class="m">50</span> <span class="m">58</span> <span class="m">83</span> <span class="m">72</span> <span class="m">46</span> <span class="m">9</span> <span class="m">5</span> <span class="m">56</span> <span class="m">42</span> <span class="m">48</span> <span class="m">11</span> <span class="m">49</span> <span class="m">38</span> <span class="m">6</span> <span class="m">39</span> <span class="m">45</span> <span class="m">8</span> <span class="m">16</span>
					   <span class="m">27</span> <span class="m">78</span> <span class="m">74</span> <span class="m">30</span> <span class="m">79</span> <span class="m">34</span> <span class="m">40</span> <span class="m">20</span> <span class="m">19</span> <span class="m">36</span> <span class="m">14</span> <span class="m">24</span> <span class="m">53</span> <span class="m">35</span> <span class="m">33</span> <span class="m">12</span> <span class="m">25</span> <span class="m">55</span> <span class="m">51</span> <span class="m">26</span> <span class="m">13</span>
					   <span class="m">23</span> <span class="m">21</span> <span class="m">52</span> <span class="m">28</span> <span class="m">17</span> <span class="m">31</span> <span class="m">22</span> <span class="m">18</span> <span class="m">32</span> <span class="m">43</span> <span class="m">29</span> <span class="m">61</span> <span class="m">10</span> <span class="m">54</span> <span class="ss">)</span><span class="p">.</span>

			<span class="bp">self</span> <span class="nf">assert_testTopologicalSortOnCycleDo3_edgesEqualsTo:</span> <span class="nv">edges</span> ]
</pre></div>
</div>
<blockquote>
<div><p>where</p>
<span class="target" id="compiledMethod-26"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Containers-LinkedStoragePool-Examples&quot;</span>
<span class="nf">topologicalSortByAssociations:</span> <span class="nv">aRelation</span> <span class="nf">acyclicDo:</span> <span class="nv">aBlock</span>

	<span class="o">|</span><span class="nv"> ordering edges </span><span class="o">|</span>
	<span class="nv">edges</span> <span class="o">:=</span> <span class="nc">Array</span> <span class="nf">streamContents:</span> [ <span class="o">:</span><span class="nv">aStream</span> <span class="o">|</span> 
		         [ 
		         <span class="o">|</span> <span class="nv">isAcyclic</span> <span class="nf">|</span>
		         <span class="nv">isAcyclic</span> <span class="o">:=</span> <span class="bp">true</span><span class="p">.</span>
		         <span class="nv">ordering</span> <span class="o">:=</span> <span class="bp">self</span>
			                     <span class="nf">topologicalSortByAssociations:</span> <span class="nv">aRelation</span>
			                     <span class="nf">onCycleDo:</span> [ <span class="o">:</span><span class="nv">sequence</span> <span class="o">:</span><span class="nv">cycle</span> <span class="o">|</span> 
				                     <span class="o">|</span><span class="nv"> edge </span><span class="o">|</span>
				                     <span class="nv">isAcyclic</span> <span class="o">:=</span> <span class="bp">false</span><span class="p">.</span>
				                     <span class="nv">edge</span> <span class="o">:=</span> <span class="nv">cycle</span> <span class="nf">anyOne</span><span class="p">.</span>
				                     <span class="nv">aStream</span> <span class="nf">nextPut:</span> <span class="nv">edge</span><span class="p">.</span>
				                     <span class="nv">aRelation</span> <span class="nf">remove:</span> <span class="nv">edge</span><span class="p">.</span>
				                     <span class="nv">sequence</span> ]<span class="p">.</span>
		         <span class="nv">isAcyclic</span> ] <span class="nf">whileFalse</span> ]<span class="p">.</span>

	<span class="o">^</span> <span class="nv">aBlock</span> <span class="nf">value:</span> <span class="nv">ordering</span> <span class="nf">value:</span> <span class="nv">edges</span>
</pre></div>
</div>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="linkedlist-containers">
<h2><code class="docutils literal notranslate"><span class="pre">LinkedList</span></code> containers<a class="headerlink" href="#linkedlist-containers" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> objects are small and allow us to compose them in an applicative
way so that we can share part of a composite structure among different client
objects so that those clients don’t observe any side effect on the
<code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> objects they are currently referencing.</p>
<p>By the way, some applications prefer to have a manager object that handles
those links as a whole, hiding the inner machinery that keeps their structure
sound. Those managers are called <em>containers</em>.</p>
<p>A <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> understands the <code class="docutils literal notranslate"><span class="pre">#asLinkedList</span></code> message to enclose itself in
a <code class="docutils literal notranslate"><span class="pre">LinkedList</span></code> container</p>
<span class="target" id="pharo-class-2"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="nc">SequenceableCollection</span> <span class="nf">subclass:</span> <span class="ss">#LinkedList</span>
	<span class="nf">instanceVariableNames:</span> <span class="s">&#39;firstLink lastLink&#39;</span>
	<span class="nf">classVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">package:</span> <span class="s">&#39;Collections-Sequenceable-Base&#39;</span>
</pre></div>
</div>
<p>for example,</p>
<span class="target" id="compiledMethod-30"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testAsLinkedList</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="bp">self</span> <span class="nf">testSimpleValueLink</span> <span class="nf">asLinkedList</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testAsLinkedList.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testAsLinkedList.svg" /><p>where</p>
<span class="target" id="compiledMethod-29"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;ValueLink, protocol *Collections-Support-Extensions&quot;</span>
<span class="nf">asLinkedList</span>

	<span class="o">|</span><span class="nv"> list </span><span class="o">|</span>
	<span class="nv">list</span> <span class="o">:=</span> <span class="nc">LinkedList</span> <span class="nf">empty</span><span class="p">.</span>
	<span class="bp">self</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">list</span> <span class="nf">addLast:</span> <span class="nv">each</span> <span class="nf">value</span> ]<span class="p">.</span>
	<span class="o">^</span> <span class="nv">list</span>
</pre></div>
</div>
<blockquote>
<div><p>where</p>
<span class="target" id="compiledMethod-28"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Link, protocol *Collections-Support-Extensions&quot;</span>
<span class="nf">do:</span> <span class="nv">aBlock</span>

	<span class="o">|</span><span class="nv"> link </span><span class="o">|</span>
	<span class="nv">link</span> <span class="o">:=</span> <span class="bp">self</span><span class="p">.</span>
	[ <span class="nv">link</span> ] <span class="nf">whileNotNil:</span> [ 
		<span class="nv">aBlock</span> <span class="nf">value:</span> <span class="nv">link</span><span class="p">.</span>
		<span class="nv">link</span> <span class="o">:=</span> <span class="nv">link</span> <span class="nf">nextLink</span><span class="p">.</span>
		<span class="nv">link</span> <span class="nf">==</span> <span class="bp">self</span> <span class="nb">ifTrue:</span> [ <span class="nv">link</span> <span class="o">:=</span> <span class="bp">nil</span> ] ]
</pre></div>
</div>
</div></blockquote>
</div></blockquote>
<p>Two observations are in order:</p>
<ul>
<li><p>On one hand, since the slot <code class="docutils literal notranslate"><span class="pre">nextLink</span></code> hosts either a <code class="docutils literal notranslate"><span class="pre">Link</span></code> or <code class="docutils literal notranslate"><span class="pre">nil</span></code>
then the latter has to understand</p>
<span class="target" id="compiledMethod-31"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;UndefinedObject, protocol *Kernel-Extensions&quot;</span>
<span class="nf">asLinkedList</span>

	<span class="o">^</span> <span class="nc">LinkedList</span> <span class="nf">empty</span>
</pre></div>
</div>
<p>too and it behaves as follows</p>
<span class="target" id="compiledMethod-32"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testNilAsLinkedList</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="bp">nil</span> <span class="nf">asLinkedList</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testNilAsLinkedList.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testNilAsLinkedList.svg" /></div></blockquote>
</li>
<li><p>On the other hand, since a <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> could keep a recursive structure
then all the values are kept as well</p>
<span class="target" id="compiledMethod-33"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testAsLinkedList4321</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> <span class="bp">self</span> <span class="nf">test4321ValueLinks</span> <span class="nf">asLinkedList</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testAsLinkedList4321.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testAsLinkedList4321.svg" /></div></blockquote>
</li>
</ul>
<p>Additionally, <code class="docutils literal notranslate"><span class="pre">LinkedList</span></code> objects can be built using other objects than
<code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> ones, for example sending <code class="docutils literal notranslate"><span class="pre">#as:</span></code> to an <code class="docutils literal notranslate"><span class="pre">Interval</span></code>,</p>
<span class="target" id="compiledMethod-35"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testAsLinkedListFromInterval</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphOf:</span> ((<span class="m">4</span> <span class="nf">to:</span> <span class="m">1</span> <span class="nf">by:</span> <span class="m">-1</span>) <span class="nf">as:</span> <span class="nc">LinkedList</span>)
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testAsLinkedListFromInterval.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testAsLinkedListFromInterval.svg" /><p>where</p>
<span class="target" id="compiledMethod-34"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Number, protocol *Collections-Sequenceable&quot;</span>
<span class="nf">to:</span> <span class="nv">stop</span> <span class="nf">by:</span> <span class="nv">step</span>

	<span class="c">&quot;Answer an Interval from the receiver up to the argument, stop, </span>
<span class="c">	incrementing by step.&quot;</span>

	<span class="o">^</span> <span class="nc">Interval</span> <span class="nf">from:</span> <span class="bp">self</span> <span class="nf">to:</span> <span class="nv">stop</span> <span class="nf">by:</span> <span class="nv">step</span>
</pre></div>
</div>
<p>and</p>
<span class="target" id="pharo-class-3"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="nc">SequenceableCollection</span> <span class="nf">subclass:</span> <span class="ss">#Interval</span>
	<span class="nf">instanceVariableNames:</span> <span class="s">&#39;start stop step&#39;</span>
	<span class="nf">classVariableNames:</span> <span class="s">&#39;&#39;</span>
	<span class="nf">package:</span> <span class="s">&#39;Collections-Sequenceable-Base&#39;</span>

<span class="c">&quot;I represent a finite arithmetic progression (a range of number).</span>

<span class="c">Description</span>
<span class="c">--------------------------</span>

<span class="c">I allow to iterate easily on a range of number (for example to manupulate an index) with a define step (by default one by one).</span>

<span class="c">Zero step size is not allowed and will raise an error.</span>

<span class="c">I know at which number I begin, at which number I end and the step.</span>

<span class="c">I work with the Number class. I manipulate some numbers and I can be created from a Number.  </span>

<span class="c">Public API and Key Messages</span>
<span class="c">--------------------------</span>

<span class="c">- I implement most of the classic Iterators as #do: or #collect:.</span>

<span class="c">- #from: to: and #from: to: by:  are my two common contructors. But I am usually created by a message send on Number  (See examples).</span>

<span class="c">Examples </span>
<span class="c">--------------------------</span>

<span class="c">To create an Interval from 1 to 100 there is many ways:</span>

<span class="c">	Interval from: 1 to: 100</span>
<span class="c">	or</span>
<span class="c">	Interval from: 1 to: 100 by: 1</span>
<span class="c">	</span>
<span class="c">	or from a Number </span>
<span class="c">	</span>
<span class="c">	1 to: 100 </span>
<span class="c">	or </span>
<span class="c">	1 to: 100 by: 1</span>
<span class="c">	</span>
<span class="c">	You can also use floats or fractions: </span>
<span class="c">	</span>
<span class="c">	0.1 to: 0.5 by: 0.01</span>
<span class="c">	or</span>
<span class="c">	1/10 to: 1/2 by: 1/100</span>
<span class="c">	</span>
<span class="c">	NB: both expressions will not give exactly the same result. The first will contains only floats and the second only fractions.</span>
<span class="c">	</span>
<span class="c"> </span>
<span class="c">Internal Representation and Key Implementation Points.</span>
<span class="c">--------------------------</span>

<span class="c">    Instance Variables</span>
<span class="c">	start:		&lt;Number&gt; 	The beginning of the Interval.</span>
<span class="c">	step:		&lt;Number&gt; 	The end of the Interval.</span>
<span class="c">	stop:		&lt;Number&gt; 	The step of the interval. If the step is 3 and we begin at 1 the interval will be 1, 4, 7, 10, 13… until the end.&quot;</span>
</pre></div>
</div>
</div></blockquote>
<p>Moreover, from a <code class="docutils literal notranslate"><span class="pre">SequenceableCollection</span></code> we can revert back to a <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> with,</p>
<span class="target" id="compiledMethod-37"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Collections-Sequenceable-Extensions&quot;</span>
<span class="nf">asValueLink</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">foldr:</span> <span class="ss">#~~&gt;</span> <span class="nf">init:</span> <span class="bp">nil</span>
</pre></div>
</div>
<blockquote>
<div><p>where <code class="docutils literal notranslate"><span class="pre">#foldr:init:</span></code> folds by associating to the right,</p>
<span class="target" id="compiledMethod-36"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;SequenceableCollection, protocol *Collections-Sequenceable-Extensions&quot;</span>
<span class="nf">foldr:</span> <span class="nv">aBlock</span> <span class="nf">init:</span> <span class="nv">init</span>

	<span class="o">|</span><span class="nv"> cell </span><span class="o">|</span>
	<span class="nv">cell</span> <span class="o">:=</span> <span class="nv">init</span><span class="p">.</span>
	<span class="bp">self</span> <span class="nf">reverseDo:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">cell</span> <span class="o">:=</span> <span class="nv">aBlock</span> <span class="nf">value:</span> <span class="nv">each</span> <span class="nf">value:</span> <span class="nv">cell</span> ]<span class="p">.</span>
	<span class="o">^</span> <span class="nv">cell</span>
</pre></div>
</div>
</div></blockquote>
<p>as we can see in the following example</p>
<span class="target" id="compiledMethod-38"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testAsValueLink</span>

	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> (<span class="m">4</span> <span class="nf">to:</span> <span class="m">1</span> <span class="nf">by:</span> <span class="m">-1</span>) <span class="nf">asValueLink</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testAsValueLink.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testAsValueLink.svg" /></div></blockquote>
<p>Using another folding message <code class="docutils literal notranslate"><span class="pre">#inject:into:</span></code> that associates to the left,</p>
<span class="target" id="compiledMethod-39"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;Collection, protocol enumerating&quot;</span>
<span class="nf">inject:</span> <span class="nv">thisValue</span> <span class="nf">into:</span> <span class="nv">binaryBlock</span>

	<span class="c">&quot;Accumulate a running value associated with evaluating the argument, binaryBlock, with the current value of the argument, thisValue, and the receiver as block arguments.&quot;</span>

	<span class="c">&quot;( #(1 2 3) inject: 0 into: [ :sum :each | sum + each ] ) &gt;&gt;&gt; 6&quot;</span>

	<span class="o">|</span><span class="nv"> nextValue </span><span class="o">|</span>
	<span class="nv">nextValue</span> <span class="o">:=</span> <span class="nv">thisValue</span><span class="p">.</span>
	<span class="bp">self</span> <span class="nf">do:</span> [ <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> 
		<span class="nv">nextValue</span> <span class="o">:=</span> <span class="nv">binaryBlock</span> <span class="nf">value:</span> <span class="nv">nextValue</span> <span class="nf">value:</span> <span class="nv">each</span> ]<span class="p">.</span>
	<span class="o">^</span> <span class="nv">nextValue</span>
</pre></div>
</div>
<p>we obtain a <code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> that keeps the same elements in <em>reversed</em> order,</p>
<span class="target" id="compiledMethod-40"></span><div class="highlight-smalltalk notranslate"><div class="highlight"><pre><span></span><span class="c">&quot;CTLinkedStorageValueLinkTest, protocol tests&quot;</span>
<span class="nf">testAsValueLinkInjectInto</span>

	<span class="o">|</span><span class="nv"> l </span><span class="o">|</span>
	<span class="nv">l</span> <span class="o">:=</span> (<span class="m">4</span> <span class="nf">to:</span> <span class="m">1</span> <span class="nf">by:</span> <span class="m">-1</span>)
		     <span class="nf">inject:</span> <span class="bp">nil</span>
		     <span class="nf">into:</span> [ <span class="o">:</span><span class="nv">aValueLink</span> <span class="o">:</span><span class="nv">each</span> <span class="o">|</span> <span class="nv">each</span> <span class="nf">~~&gt;</span> <span class="nv">aValueLink</span> ]<span class="p">.</span>
	<span class="o">^</span> <span class="bp">self</span> <span class="nf">exportSlotsGraphRecursiveOf:</span> <span class="nv">l</span>
</pre></div>
</div>
<blockquote>
<div><img alt="../_images/CTLinkedStorageValueLinkTest-testAsValueLinkInjectInto.svg" class="align-center" src="../_images/CTLinkedStorageValueLinkTest-testAsValueLinkInjectInto.svg" /></div></blockquote>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Linked memory allocation</a><ul>
<li><a class="reference internal" href="#links">Links</a><ul>
<li><a class="reference internal" href="#link-objects"><code class="docutils literal notranslate"><span class="pre">Link</span></code> objects</a></li>
<li><a class="reference internal" href="#valuelink-objects"><code class="docutils literal notranslate"><span class="pre">ValueLink</span></code> objects</a><ul>
<li><a class="reference internal" href="#test-case-topological-sorting">Test case: Topological sorting</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#linkedlist-containers"><code class="docutils literal notranslate"><span class="pre">LinkedList</span></code> containers</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Data Structures in Smalltalk</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/linked-allocation/linked-allocation.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../index.html" title="Data Structures in Smalltalk"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Data Structures in Smalltalk  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Linked memory allocation</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Massimo Nocentini.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.4.1.
    </div>
  </body>
</html>